"use strict";(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[5062],{72232:function(e,t,s){s.d(t,{Z:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"backdrop-blur-2xl bg-dark-N16 cursor-pointer fixed h-14 right-6 rounded-full transition-opacity w-14",style:{opacity:e.showBackToTopOpacity,bottom:`${e.showBackToTopBottom}px`},on:{click:function(t){return t.stopPropagation(),e.scrollToTop.apply(null,arguments)}}},[t("img",{staticClass:"mx-auto",style:{marginTop:"23px"},attrs:{src:s(80779)}})])},r=[];const n=22,a=56,o=window.innerHeight;var l={name:"BackToTop",data(){return{showBackToTopBottom:-a,showBackToTopOpacity:0}},computed:{scrollableEl(){return this.$el.parentElement}},beforeUnmount(){this.scrollableEl.removeEventListener("scroll",this.onScroll)},mounted(){this.scrollableEl.addEventListener("scroll",this.onScroll)},methods:{onScroll(e){const t=o,{scrollTop:s}=e.target,i=s-t;if(i>0){this.showBackToTopOpacity=1;let e=-a+i;e>n&&(e=n),this.showBackToTopBottom=e}else this.showBackToTopOpacity=0},scrollToTop(){this.scrollableEl.scrollTo(0,0)}}},p=l,c=s(1001),u=(0,c.Z)(p,i,r,!1,null,null,null),h=u.exports},8893:function(e,t,s){s.d(t,{Z:function(){return g}});var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[e.disabled?e._e():t("div",{staticClass:"bg-dark-N16 border border-black border-opacity-10 cursor-pointer flex items-center justify-between mb-2 px-6 py-3 rounded-lg t-token_item-click",on:{click:e.click}},[t("token-icon",{staticClass:"h-9 w-9",attrs:{address:e.address,chain:e.chain,"icon-uri":e.value.logoURI},on:{hideUnverifiedTokenPopover:e.hideUnverifiedTokenPopover,showUnverifiedTokenPopover:e.showUnverifiedTokenPopover}}),t("div",{staticClass:"flex-1 mx-4"},[t("div",{staticClass:"font-bold tracking-wider"},[e._v(e._s(e.name))]),t("div",{staticClass:"flex items-center text-dark-N77 text-xs"},[t("span",{staticClass:"mr-2"},[e._v(e._s(e.symbol))]),t("chain-badge",{attrs:{"background-color":"bg-input-bg",chain:e.chain}}),e.type&&e.type!==e.symbol?t("div",{staticClass:"bg-input-bg inline-block ml-1 px-2 py-0 rounded-full"},[e._v(" "+e._s(e.type)+" ")]):e._e()],1)]),e.selectable?t("opera-checkbox",{ref:"checkbox",staticClass:"pointer-events-none",attrs:{"model-value":e.modelValue,value:e.value},on:{change:e.onChange}}):e._e()],1),t("unverified-token-popover",{ref:"unverifiedTokenPopover",attrs:{"caret-horizontal-position":"left-[11px]","popover-position":"left-2","shorter-text":""}})],1)},r=[],n=s(43130),a=s(3998),o=s(69790),l=s(92266),p=s(30058),c=s(20144),u=c.ZP.extend({name:"TokenItem",components:{ChainBadge:n.Z,OperaCheckbox:a.Z,TokenIcon:l.Z,UnverifiedTokenPopover:p.Z},model:{event:"change",prop:"modelValue"},props:{address:{default:"",type:String},chain:{default:void 0,type:Object},disabled:{default:!1,type:Boolean},modelValue:{default:void 0,type:[String,Object,Array]},name:{default:"",type:String},selectable:{default:!0,type:Boolean},symbol:{default:"",type:String},value:{default:void 0,type:[String,Object,Array]}},computed:{type(){const e=this.value.type??this.value.contract?.type;return e?"".toUpperCase():""},unverifiedTokenPopover(){return this.$refs.unverifiedTokenPopover}},methods:{click(){this.selectable?this.$refs.checkbox.$el.click():this.$emit("change",this.value)},getStatsEventName(){if("WatchListSelect"===this.$route.name){const e=this.$refs.checkbox.isChecked?"selected":"unselected";return`wt_watch_coin_${e}`}return"ReceiveToken"===this.$route.name?"wt_receive_select":"wt_coin_selected"},hideUnverifiedTokenPopover(e){this.unverifiedTokenPopover.hide(e)},onChange(e){const[t,s]=[this.$store.getters.getNetworkName(this.chain),this.symbol],i=this.getStatsEventName();o.Z.sendStatsEvent(o.Z.types.CLICK,i,{network:t,symbol:s}),this.$emit("change",e)},showUnverifiedTokenPopover(e){this.unverifiedTokenPopover.show(e)}}}),h=u,d=s(1001),m=(0,d.Z)(h,i,r,!1,null,null,null),g=m.exports},33668:function(e,t,s){s.d(t,{Z:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"flex flex-row overflow-x-auto rtl-space-x-reverse space-x-4"},e._l(e.percentageValues,(function({label:s,divisor:i}){return t("button",{key:s,staticClass:"border font-bold px-2 py-1 rounded-md text-brand-primary text-sm w-14",class:[{"border-brand-primary bg-brand-primary bg-opacity-5":s===e.selected,"border-black border-opacity-20 bg-gray":s!==e.selected},`t-perc-btn t-perc-btn-${s}`],on:{click:function(t){return e.select({label:s,divisor:i})}}},[t("span",1===i?[e._v(e._s(e.$t("general.max")))]:[e._v(e._s(e.localizePercentage(s)))])])})),0)},r=[],n=s(70794),a=s(10359),o=s(37426),l={name:"PercentageButtons",props:{token:{default:void 0,type:Object},value:{default:void 0,type:[n.Z,Number,String]}},data(){return{calculatedAmount:null,percentageValues:[{divisor:4,label:"25"},{divisor:2,label:"50"},{divisor:1,label:"100"}],selected:null}},watch:{value(){this.value!==this.calculatedAmount&&(this.selected=null)}},methods:{calculateAmount(e){const t=Object.assign({},this.token,{balance:new n.Z(this.token.balance).dividedBy(e)});this.calculatedAmount=o.Z.tokenDecimal(t)||(0,n.Z)(0),this.$emit("change",this.calculatedAmount)},localizePercentage:a.Z.localizePercentage,select({label:e,divisor:t}){this.selected=e,this.calculateAmount(t)}}},p=l,c=s(1001),u=(0,c.Z)(p,i,r,!1,null,null,null),h=u.exports},30058:function(e,t,s){s.d(t,{Z:function(){return u}});var i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("simple-popover",{ref:"popover",staticClass:"fixed font-medium h-min t-unverified_token_popover text-sm w-72 z-10",class:[e.popoverPosition],attrs:{"background-class":"bg-dark-N04","caret-horizontal-position":e.caretHorizontalPosition,"caret-vertical-inset":"bottom"}},[e.shorterText?t("p",[e._v(e._s(e.$t("components.popovers.unverifiedTokenShorter")))]):t("i18n",{staticClass:"whitespace-pre-line",attrs:{path:"components.popovers.unverifiedToken",tag:"p"},scopedSlots:e._u([{key:"settingsPage",fn:function(){return[t("span",{staticClass:"cursor-pointer text-brand-primary",on:{click:function(t){return e.$emit("showAssetSettingsDialog")}}},[e._v(e._s(e.$t("components.popovers.unverifiedTokenSettingsPage")))])]},proxy:!0}])})],1)},r=[],n=s(18135),a=s(20144),o=a.ZP.extend({name:"UnverifiedTokenPopover",components:{SimplePopover:n.Z},props:{caretHorizontalPosition:{default:"left-7",type:String},popoverPosition:{default:"left-6",type:String},shorterText:{default:!1,type:Boolean}},computed:{popover(){return this.$refs.popover}},methods:{hide(e){this.popover.hide(e)},show(e){this.popover.show(),this.$nextTick((()=>{const t=this.popover.$el,s=11,i=t.offsetHeight+e.offsetY+s;t.style.top=e.pageY-i+"px"}))}}}),l=o,p=s(1001),c=(0,p.Z)(l,i,r,!1,null,"47f33c28",null),u=c.exports},55062:function(e,t,s){s.r(t),s.d(t,{default:function(){return ne}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pb-8"},[t("div",{staticClass:"flex flex-col flex-grow h-full"},[t("top-bar",{attrs:{"test-parent-name":"swap_view",title:e.$t("general.swap")}}),t("div",{key:e.timesSwappableTokensUpdated,staticClass:"flex flex-col flex-grow justify-start mt-4 mx-4"},[t("swap-input",{staticClass:"mb-4 t-swap-from_balance",class:[{"pointer-events-none":e.isLoading||!!e.currentPendingApprovalHash}],attrs:{balance:e.fromBalance,type:"from"},model:{value:e.from,callback:function(t){e.from=t},expression:"from"}}),t("div",{staticClass:"flex flex-col items-center"},[t("horizontal-divider",{staticClass:"my-3"},[t("button",{staticClass:"bg-brand-primary bg-opacity-10 flex-shrink-0 h-10 rounded-full t-swap-switch w-10",class:{"cursor-not-allowed":e.disableTokenSwitch||!!e.currentPendingApprovalHash},attrs:{disabled:e.disableTokenSwitch,title:e.disableTokenSwitch?e.$t("general.youDontOwnAny",{asset:e.toSymbol}):""},on:{click:e.switchTokens,mouseleave:function(t){e.exchangeHover=!1},mouseover:function(t){e.exchangeHover=!0}}},[t("i",{staticClass:"align-bottom icon text-brand-primary",class:{"icon-exchange":e.exchangeHover,"icon-swap_arrow":!e.exchangeHover}})])])],1),t("swap-input",{staticClass:"t-swap-to_balance",class:[{"pointer-events-none":e.isLoading||!!e.currentPendingApprovalHash}],attrs:{balance:e.toBalance,"read-only":"",type:"to"},model:{value:e.to,callback:function(t){e.to=t},expression:"to"}}),t("swap-info",{class:[{"pointer-events-none":e.isLoading}],attrs:{conversion:e.conversion,error:e.generalTxError,price:e.price,"show-info":!(!e.from.value||!e.to.value),"to-token-amount":e.toTokenAmount},on:{changeSlippage:e.changeSlippage,refreshTx:e.refreshTx}})],1),e.currentPendingApprovalHash?t("div",[t("div",[t("div",{staticClass:"bg-dark-N16-op50 m-4 mb-4 px-6 py-4 rounded-lg text-dark-N77 text-sm"},[t("i18n",{attrs:{path:"views.swapView.pendingApproval"},scopedSlots:e._u([{key:"pendingApprovalLink",fn:function(){return[t("a",{staticClass:"cursor-pointer text-brand-primary",on:{click:function(t){return e.openApprovalDetails()}}},[e._v(" "+e._s(e.$t("views.swapView.pendingApprovalLinkTitle"))+" ")])]},proxy:!0}],null,!1,2148050931)})],1)])]):e._e(),t("p",{staticClass:"text-2xs text-center text-dark-N77"},[e._v(" "+e._s(e.$t("views.swapView.providedByOpera"))+" ")]),t("primary-button",{staticClass:"mt-4 mx-4 relative t-swap-swap",attrs:{disabled:e.invalidStateOrPendingApproval,loading:e.isLoading||!!e.currentPendingApprovalHash,title:e.primaryButtonText},on:{click:function(t){e.isApproveRequired?e.getApprove():e.getSwap()}}},[t("lottie-component",{staticClass:"absolute",attrs:{src:"loader_button.json"}})],1)],1)])},r=[],n=(s(57658),s(47812)),a=s(79317);const o=(e,t)=>{let s;return function(...i){return void 0!==s&&t||e.apply(this,i),clearTimeout(s),s=setTimeout((()=>e.apply(this,i)),t),s}};var l,p=s(46686),c=s(70794),u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"border-opacity-10 line-divider w-full"},[e._t("default")],2)},h=[],d={name:"HorizontalDivider"},m=d,g=s(1001),f=(0,g.Z)(m,u,h,!1,null,"0c0ab06d",null),v=f.exports,k=s(76501),w=s(25319),b=s(69790),x=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"mt-8 w-full"},[e.showInfo||e.error?e.error&&!e.insufficientFunds?t("div",{staticClass:"bg-dark-N16 flex flex-col font-semibold gap-3.5 h-60 items-center justify-center rounded-3xl text-center text-spectrum-red text-xs"},[t("img",{staticClass:"h-14 mb-0.5 w-14",attrs:{src:s(571)}}),t("div",[e._v(" "+e._s(e.$t("errors.generic.somethingWentWrongShort"))+" ")]),t("div",{staticClass:"cursor-pointer text-accent underline",on:{click:function(t){return e.$emit("refreshTx")}}},[e._v(" "+e._s(e.$t("general.refresh"))+" ")])]):t("div",[t("div",{staticClass:"bg-dark-N16-op50 flex items-center justify-center px-6 py-4 rounded-4xl"},[t("div",{staticClass:"max-w-full text-sm"},[t("p",{staticClass:"max-w-fit truncate"},[t("span",[e._v(e._s(e.conversion)+" ")]),t("span",{staticClass:"text-dark-N77"},[e._v(e._s(e.price))])])])]),t("div",{staticClass:"bg-dark-N16-op50 mb-3 mt-6 px-6 py-4 rounded-xl"},[t("div",{staticClass:"flex items-center justify-between"},[t("div",[t("div",{staticClass:"text-[13px] text-dark-N77"},[e._v(" "+e._s(e.$t("components.swapInfo.slippageTolerance"))+" ")]),e.showSlippageSettings?t("p",{staticClass:"text-dark-N77-op50 text-xs"},[e._v(" "+e._s(e.$t("components.swapInfo.selectSuggested"))+" ")]):t("div",{staticClass:"mt-1"},[e._v(" "+e._s(e.localizePercentage(e.slippage.toString()))+" ")])]),t("div",{staticClass:"flex items-center"},[t("i",{staticClass:"cursor-pointer icon-trans",class:[{"text-dark-N77":!e.showSlippageSettings,"text-accent":e.showSlippageSettings}],on:{click:function(t){e.showSlippageSettings=!e.showSlippageSettings}}})])]),e.showSlippageSettings?t("div",[t("slippage-buttons",{staticClass:"mt-5"}),e.errorStage&&!e.isSafeSlippage?t("div",{staticClass:"mt-5 pb-5 pt-4 px-6 rounded-lg",class:[{"text-red bg-red-10":[e.SlippageErrorStages.Insufficient,e.SlippageErrorStages.Excessive].includes(e.errorStage),"text-orange bg-orange-10":[e.SlippageErrorStages.TxMayFail,e.SlippageErrorStages.BadRate].includes(e.errorStage),"text-yellow bg-yellow-10":[e.SlippageErrorStages.ModerateRate].includes(e.errorStage)}]},[e._v(" "+e._s(e.errorList.get(e.errorStage))+" ")]):e._e()],1):e._e()]),e.isValidSlippage?t("div",{staticClass:"bg-dark-N16-op50 flex items-center justify-between mb-3 mt-1 px-6 py-4 rounded-xl"},[t("div",[t("div",{staticClass:"text-dark-N77 text-xs"},[e._v(" "+e._s(e.$t("components.swapInfo.minimumReceive",{slippage:e.localizePercentage(e.slippage.toString())}))+" ")]),t("div",{staticClass:"mt-1"},[e._v(" "+e._s(e.formatNumber(e.minAmountReceived))+" "+e._s(e.currentSwap.toToken.symbol)+" ")])])]):e._e()]):t("div",{staticClass:"border-2 border-dark-N16 flex h-56 items-center justify-center rounded-3xl"},[t("span",{staticClass:"opacity-50 text-base text-dark-N77"},[e._v(e._s(e.$t("components.swapInfo.enterSwapAmount")))])])])},y=[];(function(e){e[e["Insufficient"]=1]="Insufficient",e[e["TxMayFail"]=2]="TxMayFail",e[e["ModerateRate"]=3]="ModerateRate",e[e["BadRate"]=4]="BadRate",e[e["Excessive"]=5]="Excessive"})(l||(l={}));var T=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"flex flex-row justify-between overflow-x-auto rtl-space-x-reverse space-x-2 t-slippage_buttons"},[e._l(e.slippageOptions,(function(s){return t("button",{key:s,staticClass:"border flex-1 font-bold leading-6 mb-1 py-1 rounded-md text-brand-primary text-sm w-11",class:[{"border-brand-primary bg-brand-primary bg-opacity-5":s===e.slippage&&!e.showInput,"border-black border-opacity-20 bg-gray":s!==e.slippage||e.showInput}],on:{click:function(t){return e.select(s)}}},[t("span",[e._v(e._s(e.localizePercentage(s.toString())))])])})),t("div",{staticClass:"flex-1 h-8.5 w-28"},[e.showInput?t("div",{staticClass:"border flex font-bold h-8.5 items-center justify-between mb-1 px-2 py-1 rounded-md text-brand-primary text-sm w-28"},[t("input",{ref:"customSlippageInput",staticClass:"bg-transparent flex-1 t-slippage_buttons-custom_slippage_input text-right w-12",attrs:{type:"string"},domProps:{value:e.slippage},on:{input:e.changeSlippage}}),t("span",{staticClass:"opacity-50 text-dark-N77"},[e._v("%")]),t("div",{staticClass:"flex-1"})]):t("button",{staticClass:"bg-gray border border-black border-opacity-20 font-bold leading-6 mb-1 px-2 py-1 rounded-md text-brand-primary text-sm w-fit",on:{click:e.handleShowInput}},[e._v(" "+e._s(e.$t("general.custom"))+" ")])])],2)},S=[],_=s(20144),$=s(10359),C=_.ZP.extend({name:"SlippageButtons",data(){return{showInput:!1,slippageOptions:this.$store.state.swap.slippageOptions,slippageUpdateTimer:null}},computed:{isValidSlippage(){return this.getIsValidSlippage(this.slippage)},slippage(){return this.$store.getters.slippage},slippageDecimal(){return this.$store.getters.slippageData.slippageDecimal}},methods:{changeSlippage(e){clearTimeout(this.slippageUpdateTimer);const t=this.sanitizeValue(e);t!==this.slippage&&(this.slippageUpdateTimer=window.setTimeout((()=>{this.$store.dispatch("setSlippage",t)}),this.getIsValidSlippage(t)?1e3:0))},getIsValidSlippage(e){return this.$store.getters.isValidSlippage(e)},handleShowInput(){this.showInput=!0,this.$nextTick((()=>{this.$refs.customSlippageInput?.focus()}))},isValidSlippagePattern(e){const t=new RegExp(`^(0|[1-9]\\d{0,1})([\\.\\,]\\d{1,${this.slippageDecimal}})?$`),s=[".",","].some((t=>e.endsWith(t)));return t.test((s?+e:e).toString())},localizePercentage:$.Z.localizePercentage,sanitizeValue({target:e}){let{value:t}=e;t=t?.replace(",",".");const s=new Map([["isTruthy",!!t&&!isNaN(+t)],["isValidSlippage",this.isValidSlippagePattern(t)],["isValidSlippagePercentage",+t>=0||+t<100]]);return[...s.values()].some((e=>!e))&&(t="0",e.value=null),+t},select(e){this.showInput=!1,this.$store.dispatch("setSlippage",e)}}}),A=C,Z=(0,g.Z)(A,T,S,!1,null,"f0130492",null),P=Z.exports,I=_.ZP.extend({name:"SwapInfo",components:{SlippageButtons:P},props:{conversion:{default:"",type:String},error:{default:!1,type:Boolean},price:{default:"",type:String},showInfo:{default:!1,type:Boolean},toTokenAmount:{default:new c.Z(0),type:c.Z}},data(){return{SlippageErrorStages:l,errorStage:void 0,showSlippageSettings:!1,slippageOptions:this.$store.state.swap.slippageOptions}},computed:{currentSwap(){return this.$store.getters.currentSwap},errorIndex(){const{max:e,min:t,slippageOptions:s}=this,{Insufficient:i,TxMayFail:r,ModerateRate:n,BadRate:a,Excessive:o}=l;return new Map([[t,i],[s.at(0),r],[s.at(-1),n],[e+t,a],[100,o]])},errorList(){const{max:e,min:t,slippage:s}=this,{Insufficient:i,TxMayFail:r,ModerateRate:n,BadRate:a,Excessive:o}=l;return new Map([[i,this.$i18n.t("components.swapInfo.minimumSlippageRate",{slippage:this.localizePercentage(t.toString())})],[r,this.$i18n.t("components.swapInfo.yourTransactionMayFail")],[n,this.$i18n.t("components.swapInfo.youMayReceive",{slippage:this.localizePercentage(s.toString())})],[a,this.$i18n.t("components.swapInfo.youMayReceiveAnd",{slippage:this.localizePercentage(s.toString())})],[o,this.$i18n.t("components.swapInfo.maximumSlippageRate",{slippage:this.localizePercentage(e.toString())})]])},insufficientFunds(){return this.$store.getters.txError.insufficientFunds},isSafeSlippage(){return this.slippage>=this.slippageOptions.at(0)&&this.slippage<=1},isValidSlippage(){return this.$store.getters.isValidSlippage()},max(){return this.slippageData.slippageMax},min(){return this.slippageData.slippageMin},minAmountReceived(){return this.toTokenAmount.times(1-this.slippage/100)},slippage(){return this.$store.getters.slippage},slippageData(){return this.$store.getters.slippageData}},watch:{slippage(e){this.errorStage=[...this.errorIndex.entries()].find((([t])=>e<t))?.at(1)}},methods:{formatNumber:$.Z.formatNumber,localizePercentage:$.Z.localizePercentage}}),E=I,N=(0,g.Z)(E,x,y,!1,null,"0b5a8f07",null),B=N.exports,D=function(){var e=this,t=e._self._c;return t("div",{staticClass:"w-full"},[t("div",{staticClass:"flex flex-col items-center"},[t("div",{staticClass:"flex items-end justify-between mb-3 w-full"},[t("div",{staticClass:"bg-dark-N16 cursor-pointer flex items-center justify-center pl-3 pr-4 py-1 rounded-full t-swap_input-show_dialog",on:{click:e.showDialog}},[t("token-icon",{staticClass:"h-7 mr-2 w-7",attrs:{address:e.address,chain:e.chain}}),t("div",{staticClass:"mr-4"},[t("div",{staticClass:"font-bold text-base"},[e._v(e._s(e.name))]),t("div",{staticClass:"font-semibold opacity-50 text-dark-N77 text-sm"},[e._v(" "+e._s(e.chainNameFriendly)+" ")])]),t("i",{staticClass:"icon-chevron_down"})],1),t("div",{staticClass:"grow mb-1 ml-2 mr-5 text-right text-sm"},[t("span",{staticClass:"text-dark-N77-op50"},[e._v(e._s(e.$t("general.balance"))+": ")]),t("span",{staticClass:"text-dark-N77 whitespace-pre-wrap",class:[{"text-accent":!e.readOnly}]},[e._v(e._s(e.fullBalance))])])]),t("div",{staticClass:"flex flex-col justify-center text-center w-full"},[t("input",{staticClass:"bg-neutral-01 focus:text-brand-primary input placeholder:text-white px-5 py-3.5 text-right w-full",class:[{"input-error pr-10":e.error,"cursor-not-allowed placeholder:text-neutral-06":e.readOnly}],attrs:{disabled:e.readOnly,placeholder:e.inputPlaceholder,title:""},domProps:{value:e.value.value},on:{input:function(t){return e.handleValueInput(t)},paste:function(t){return e.handleValueChanged(t)}}})]),e.error?t("div",{staticClass:"mt-2 text-center text-sm text-spectrum-red"},[e._v(" "+e._s(e.error)+" ")]):e._e(),e.readOnly?e._e():t("percentage-buttons",{staticClass:"mt-5",attrs:{token:Object.assign({},e.token,{balance:e.balanceWithoutDecimals}),value:e.value.value},on:{change:e.assignNewAmount}})],1),t("swap-token-dialog",{ref:"dialog",attrs:{type:e.type}})],1)},V=[],O=s(33668),q=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.showing,expression:"showing"}],staticClass:"bg-background bottom-0 fixed left-0 right-0 top-0 z-30"},[t("div",{staticClass:"flex flex-col h-full"},[t("top-bar",{attrs:{"emit-back":"","test-parent-name":"swap_token_dialog",title:e.$t("general.selectAssets")},on:{back:e.close}}),t("div",{staticClass:"px-4"},[t("opera-input",{staticClass:"t-swap_token_dialog-query",attrs:{placeholder:e.$t("general.search"),"prepend-icon":"icon-search text-brand-primary text-opacity-40",round:"",type:"search"},model:{value:e.query,callback:function(t){e.query=t},expression:"query"}})],1),t("div",{staticClass:"h-full overflow-y-scroll pb-4 px-4",on:{scroll:e.onScroll}},[e.loading&&e.query?t("div",{staticClass:"flex flex-1 items-center justify-center w-full"},[t("i",{staticClass:"animate-spin icon-spinner text-xl"})]):e._l(e.filteredTokens,(function(s,i){return t("token-item",{key:i,attrs:{address:s.address,chain:s.chain,disabled:e.isTokenDisabled(s),name:s.name,selectable:!1,symbol:s.symbol,value:s},on:{change:e.itemClicked}})})),t("back-to-top")],2)],1)])},R=[],L=s(72232),z=s(14957),U=s(8893),j=s(69986),H=s(37426);const Q=20;var F={name:"SwapTokenDialog",components:{BackToTop:L.Z,OperaInput:z.Z,TokenItem:U.Z,TopBar:j.Z},props:{type:{default:"",type:String}},data(){return{callback:null,filteredAssets:[],loading:!1,n:Q,query:"",showing:!1}},computed:{currentSwap(){return this.$store.getters.currentSwap},filteredTokens(){return this.query?this.filteredAssets.slice(0,this.n):this.tokens.slice(0,this.n)},ownedTokens(){return this.$store.getters.ownedTokens(a.oZ.VISIBLE)},tokens(){const{swappableTokens:e,swappableTokensFlat:t}=this.$store.getters;if("to"===this.type){const t=this.currentSwap.fromToken?.chain;return t?e[(0,p.fh)(t)]??[]:[]}return t.filter((e=>!!e.balance))}},watch:{query:{handler(e){this.loading=!0,this.filteredAssets=[],e?this.$nextTick((()=>{this.throttle(this.filterList,1e3)(),this.n=Q})):this.$nextTick((()=>{this.n=Q}))},immediate:!0}},methods:{close(){this.showing=!1},filterList(){const e=this.query.toLowerCase();this.filteredAssets=this.tokens.filter((t=>t.name.toLowerCase().includes(e)||t.symbol.toLowerCase().includes(e)||this.$store.getters.chainNameFriendly(t.chain).toLowerCase().includes(e))),this.loading=!1},isTokenDisabled(e){if(!Object.keys(this.currentSwap).length)return;const t="from"===this.type?"to":"from",s=H.Z.isSameToken(this.currentSwap[`${t}Token`],e);return s||"from"===this.type&&!e.balance},async itemClicked(e){this.loading=!0,this.callback(e),this.showing=!1,this.loading=!1},onScroll(e){const{target:t}=e,s=t.scrollTop+t.clientHeight>=t.scrollHeight-t.clientHeight;s&&(this.n+Q<this.tokens.length?this.n+=Q:this.n=this.tokens.length-1)},show(e){this.callback=e,this.showing=!0},throttle(e,t){let s,i;return function(...r){const n=Date.now(),a=this;if(i||(i=n),clearTimeout(s),n-i>t)return i=n,e.apply(a,r),void clearTimeout(s);s=setTimeout((()=>{i=Date.now(),s=null,e.apply(a,r)}),t)}}}},M=F,W=(0,g.Z)(M,q,R,!1,null,null,null),K=W.exports,G=s(92266),J={name:"SwapInput",components:{PercentageButtons:O.Z,SwapTokenDialog:K,TokenIcon:G.Z},props:{balance:{default:"",type:c.Z},readOnly:{type:Boolean},type:{default:"",type:String},value:{default:void 0,type:Object}},data(){return{focused:!1,inputPlaceholder:"0.0",token:{}}},computed:{address(){return this.token.address},balanceWithoutDecimals(){const e=this.balance??0;return H.Z.withoutDecimals(e,this.token.decimals)},chain(){return this.token.chain},chainNameFriendly(){if(this.chain)return this.$store.getters.chainNameFriendly(this.chain)},error(){const e="from"===this.type&&this.$store.getters.txError.insufficientFunds;return e&&this.$t("errors.generic.insufficientFunds")},fullBalance(){return this.$store.getters.getFullTokenBalance(this.address,this.token,this.chain,a.oZ.VISIBLE)},maxValue(){return this.readOnly?Number.MAX_SAFE_INTEGER:this.balance},name(){return this.token.name},symbol(){return this.token.symbol}},watch:{value(e){this.token=e.token}},created(){this.token=this.value.token},methods:{assignNewAmount(e){this.$emit("input",{token:this.token,value:e})},formatNumber:$.Z.formatNumber,handleValueChanged(e){const t=this.sanitizeValue(e);this.$emit("input",{token:this.token,value:t})},handleValueInput(e){this.$nextTick((()=>{this.handleValueChanged(e)}))},sanitizeValue(e){let{value:t}=e.target;return e.target.value=H.Z.sanitizeTokenAmountInput(t),t=H.Z.sanitizeTokenAmountInput(t),t},showDialog(){this.$refs.dialog.show((e=>{this.token=e,this.$emit("input",{token:this.token,value:null})}))}}},Y=J,X=(0,g.Z)(Y,D,V,!1,null,"5cbd35cb",null),ee=X.exports,te=s(25108),se={name:"SwapView",components:{HorizontalDivider:v,LottieComponent:k.Z,PrimaryButton:w.Z,SwapInfo:B,SwapInput:ee,TopBar:j.Z},data(){return{approve:null,chain:null,error:null,exchangeHover:!1,from:{token:null,value:null},interval:null,isApprovalsPending:!1,loading:{approve:!1,quote:!1,swap:!1},quote:null,timesSwappableTokensUpdated:0,to:{token:null,value:null}}},computed:{accountAddress(){return this.$store.getters.ethereumAddress},amountWithoutDecimals(){if(!this.from.token||!this.from.value)return null;const e=$.Z.removeExponential(H.Z.withoutDecimals(this.from.value,this.from.token.decimals));return e},canUpdateQuote(){return new c.Z(this.from.value??0).gt(0)&&!this.generalTxError&&this.isValidSlippage},conversion(){const e=this.quote;if(!e)return null;const t=H.Z.withDecimals(e.fromTokenAmount,e.fromToken.decimals),s=e.fromToken.symbol,i=H.Z.withDecimals(e.toTokenAmount,e.toToken.decimals).dividedBy(t),r=e.toToken.symbol;return`1 ${s} ≈ ${$.Z.formatNumber(i)} ${r}`},currentPendingApprovalHash(){return this.$store.getters.currentPendingApprovalHash},currentSwap(){return this.$store.getters.currentSwap},disableTokenSwitch(){if(this.isLoading)return!0;const e=!!this.ownedTokens.find((e=>{let t=e.contract.contract;return t===n.L1&&(t=n.NA),t===this.to.token?.address}));return!e&&(!e||!this.from.value)},fromBalance(){return this.tokenBeingSwapped?H.Z.tokenDecimal(this.tokenBeingSwapped):null},fromSymbol(){return this.from&&this.from.token?this.from.token.symbol:""},generalTxError(){return!!this.error||Object.values(this.$store.getters.txError).some((e=>e))},hasQuoteBasis(){const e=this.to.token?.address??null,t=this.from.token?.address??null,s=this.amountWithoutDecimals;return!!(e&&t&&s)},invalidBalance(){return!this.from.token||(new c.Z(this.fromBalance).isLessThan(new c.Z(this.from.value))||new c.Z(this.fromBalance).isLessThanOrEqualTo(new c.Z(0))||new c.Z(this.from.value).isLessThanOrEqualTo(new c.Z(0)))},invalidStateOrPendingApproval(){return this.isInInvalidState||!!this.currentPendingApprovalHash},isApproveRequired(){return!!this.approve},isInInvalidState(){return this.generalTxError||this.isLoading||this.invalidBalance||!this.quote||!this.$store.getters.networksSupportingSwap||!this.isValidSlippage},isLoading(){return Object.values(this.loading).some((e=>e))},isSwapUnavailable(){return this.isInInvalidState||this.isApprovalsPending||this.isApproveRequired},isValidSlippage(){return this.$store.getters.isValidSlippage()},ownedTokens(){return this.$store.getters.ownedTokens(a.oZ.VISIBLE)},pendingApprovals(){return this.$store.getters.pendingApprovals},price(){const e=this.quote;if(!e)return null;const{getPriceForToken:t}=this.$store.getters,s=$.Z.formatNumber(t(e.fromToken)),i=$.Z.formatNumber(t(e.toToken)),r=[s,i].find((e=>e.gt(0)))??new c.Z(0),n=r.gt(0)?`(${this.localizeCurrency(r)})`:"";return n},primaryButtonText(){return this.currentPendingApprovalHash?this.$t("views.swapView.processingApproval"):this.isLoading?this.$t("views.swapView.fetchingQuotes"):this.$t("general.next")},slippage(){return this.$store.getters.slippage},swappableTokens(){return this.$store.getters.swappableTokens},swapper(){return this.$store.getters.swapper},toBalance(){const e=this.determineTokenAddress(this.to.token),{chain:t}=this.to.token,s=this.$store.getters.getToken(e,t);return s?H.Z.tokenDecimal(s):null},toSymbol(){return this.to&&this.to.token?this.to.token.symbol:""},toTokenAmount(){const e=this.quote;return e?H.Z.withDecimals(this.quote.toTokenAmount,this.quote.toToken.decimals):null},tokenBeingSwapped(){if(!this.from.token)return null;const e=this.determineTokenAddress(this.from.token),{chain:t}=this.from.token;return this.$store.getters.getToken(e,t)}},watch:{chain:{deep:!0,handler(){this.$store.dispatch("setSlippageData",this.chain)}},from:{deep:!0,handler(){this.to.token&&(this.chain=this.from.token.chain,this.$store.dispatch("clearTxError"),this.$store.dispatch("createSwapper",this.chain),new c.Z(this.from.value).isGreaterThan(this.fromBalance)&&this.$store.dispatch("setTxError","insufficientFunds"),this.error=null,this.approve=null,this.updateQuote(),this.updateQueryParams(),(0,p.F2)(this.to.token?.chain,this.chain)||this.setInitialToken("to"),this.$store.commit("SET_CURRENT_SWAP",{fromToken:this.from.token,toToken:this.to.token}))}},pendingApprovals:{deep:!0,handler(e){const t=Object.keys(e).length>0;this.isApprovalsPending=t}},quote(e){this.$set(this.to,"value",e?H.Z.withDecimals(e.toTokenAmount,e.toToken.decimals):null)},slippage:{handler(){this.error=null,this.updateQuote(),this.updateQueryParams(),this.$store.commit("SET_CURRENT_SWAP",{fromToken:this.from.token,toToken:this.to.token})}},swappableTokens:{deep:!0,handler(){this.timesSwappableTokensUpdated+=1}},"to.token":{deep:!0,handler(){this.error=null,this.updateQuote(),this.updateQueryParams(),this.$store.commit("SET_CURRENT_SWAP",{fromToken:this.from.token,toToken:this.to.token})}}},beforeDestroy(){this.$store.dispatch("clearTxError"),clearInterval(this.interval)},created(){b.Z.sendStatsEvent(b.Z.types.IMPRESSION,"wt_swap_entered"),this.chain=JSON.parse(this.$route.query.chain);const e=this.$route.query.from,t=this.$route.query.to,s=this.$route.query.value||null;this.setInitialToken("from",e,s),this.setInitialToken("to",t),this.currentPendingApprovalHash&&this.updateQuote()},mounted(){this.$store.getters.getTimesLoaded("swappableTokens")||this.$store.dispatch("getSwappableTokens")},methods:{changeSlippage(e){this.slippage=e},async checkApprove(e){if(this.quote&&!this.error){this.loading.approve=!0;try{e?this.swapper.checkApprove({from:this.from,to:this.to},e).then((e=>{this.approve=e})):await this.swapper.swap({from:this.from,slippage:this.slippage,to:this.to}).then((()=>{setTimeout((()=>{Object.keys(this.pendingApprovals).length&&this.$store.dispatch("clearPendingApproval",{chain:this.chain,symbol:this.from.token.symbol})}),5e3),clearInterval(this.interval),this.approve=null})).catch((async e=>(this.$errorReporter.reportError(e),await this.swapper.checkApprove({from:this.from,to:this.to},e).then((e=>{this.approve=e})))))}catch(t){te.error(t),this.$errorReporter.reportError(t),this.error=this.generateSwapErrorText(t),clearInterval(this.interval)}finally{this.loading.approve=!1}}},commenceQuoteUpdate(){if(this.loading.quote)this.pendingApprovals.length&&this.pendingApprovals.find((e=>e.token.address!==this.from.token?.address))&&(clearInterval(this.interval),this.getQuote());else if(clearInterval(this.interval),this.currentPendingApprovalHash){const e=5e3;this.interval=setInterval((()=>{this.getQuote()}),e)}else this.getQuote()},determineTokenAddress(e){if(e)return e.address===n.NA?n.L1:e.address},generateSwapErrorText(e){const t=(e.response?.data?.description??"").toLowerCase();return this.fromSymbol===this.toSymbol?this.$t("errors.swappingTheSameToken"):t.includes("insufficient funds")||t.includes("not enough")?this.$t("errors.generic.insufficientFunds"):t.includes("insufficient liquidity")?this.$t("errors.insufficientLiquidity"):t.includes("cannot estimate")?this.$t("errors.insufficientFunds"):this.$t("errors.generic.unknownError")},getApprove(){this.currentPendingApprovalHash?this.openApprovalDetails():this.isInInvalidState||this.$router.push({name:"ApproveConfirm",params:{approve:this.approve,contract:this.swapper.contract,token:this.from}})},async getQuote(){this.loading.quote=!0;try{const e=await this.swapper.getQuote({from:this.from,to:this.to});this.quote=this.repopulateQuote(e),this.$store.commit("SET_CURRENT_SWAP",this.quote),this.error=null,await this.checkApprove()}catch(e){te.error(e),this.$errorReporter.reportError(e),this.quote=null,this.error=this.generateSwapErrorText(e)}this.loading.quote=!1},async getSwap(){if(!this.isSwapUnavailable){this.loading.swap=!0;try{const e=await this.swapper.swap({from:this.from,slippage:this.slippage,to:this.to});this.next(this.repopulateQuote(e))}catch(e){te.error(e),this.$errorReporter.reportError(e),this.checkApprove(e),this.error=this.generateSwapErrorText(e)}finally{this.loading.swap=!1}}},localizeCurrency:$.Z.localizeCurrency,async next(e){b.Z.sendStatsEvent(b.Z.types.CLICK,"wt_swap_next_suc",{network:this.$store.getters.getNetworkName(this.chain)}),this.$store.commit("SET_CURRENT_SWAP",e);const{chain:t}=this,s=this.slippage;e.tx.chain=t,this.$router.push({name:"SwapConfirm",params:{chain:t,slippageMax:s,swap:e}})},openApprovalDetails(){const e=this.$store.getters.transactionDetailsUrl(this.currentPendingApprovalHash,this.chain);this.$platform.openNewTab(e)},refreshTx(){this.error=null,this.updateQuote()},repopulateQuote(e){return Object.assign({},e,{fromToken:this.from.token,toToken:this.to.token})},setInitialToken(e,t="",s=null){let i=this.$store.getters.getTokenViaSerializedKey(t,this.chain,a.oZ.VISIBLE,!0);if(t&&i)this[e]={token:i,value:s};else{const t="from"===e?"to":"from";i=this.swappableTokens[(0,p.fh)(this.chain)].find((e=>!H.Z.isSameToken(e,this[t].token))),this[e]={token:i,value:s}}},switchTokens(){if(this.isLoading)return;const{from:e,to:t}=this;new c.Z(t.value).gt(H.Z.tokenDecimal(t.token))&&(t.value=new c.Z(H.Z.tokenDecimal(t.token))),this.from=t,this.to=e},updateQueryParams(){const e={};this.from.token&&(this.chain=this.from.token.chain,e.from=this.from.token.address,e.chain=JSON.stringify(this.from.token.chain)),this.from.value&&(e.value=this.from.value),this.to.token&&(e.to=this.to.token.address),this.$router.replace({path:this.$route.path,query:e}).catch((t=>{this.$errorReporter.reportError(t,{extraData:{path:this.$route.path,query:e}})}))},updateQuote:o((function(){if(this.canUpdateQuote)return this.hasQuoteBasis?void this.commenceQuoteUpdate():(this.quote=null,this.loading.quote=!1,void(this.error=null))}),1e3)}},ie=se,re=(0,g.Z)(ie,i,r,!1,null,null,null),ne=re.exports},571:function(e,t,s){e.exports=s.p+"img/empty_error.6fa940d6.svg"},80779:function(e,t,s){e.exports=s.p+"img/chevron_up.316e082e.svg"}}]);