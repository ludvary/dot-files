(()=>{"use strict";var e={250:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Prefs=void 0;const i="speeddial.bigger_tiles",s="ui.browser.sidebar.visible";class o{constructor(e,t,i,s){this._useBiggerTiles=e,this._sidebarVisible=t,this._adjustColumnsPref=i,this._speeddialColumnCountPref=s,this.listeners=new Map,chrome.settingsPrivate.onPrefsChanged.addListener((e=>this.onPrefsChanged(e)))}static async make(){return new o((await o.get(i)).value,(await o.get(s)).value,(await o.get("startpage.adjust_columns")).value,(await o.get("speeddial.column_count")).value)}get useBiggerTiles(){return this._useBiggerTiles}get sidebarVisible(){return this._sidebarVisible}get adjustColumnsPref(){return this._adjustColumnsPref}get speeddialColumnCountPref(){return this._speeddialColumnCountPref}static async get(e){return new Promise((t=>{chrome.settingsPrivate.getPref(e,(e=>{t(e)}))}))}onPrefsChanged(e){var t;for(let o of e){o.key===i?this._useBiggerTiles=o.value:o.key===s&&(this._sidebarVisible=o.value);for(let e of null!==(t=this.listeners.get(o.key))&&void 0!==t?t:[])e(o.key)}}addListener(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}removeListener(e,t){const i=this.listeners.get(e);if(!i)return;const s=i.indexOf(t);-1!==s&&i.splice(s,1)}}t.Prefs=o},671:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartpageGridSizeCalculator=void 0,t.StartpageGridSizeCalculator=class{constructor(e,t,i,s){var o;if(this.prefs=e,this.doubleWidthTiles=t,this.noWrap=i,this.tileHeight=s,this.MIN_COLUMN_COUNT=2,this.MIN_ROW_COUNT=1,this.Sizes=(o=this.tileHeight,{Navbar:{get WIDTH(){return 0}},Scrollbar:{WIDTH:12},Tile:{WIDTH:e=>e?188:140,HEIGHT(e){return e?Math.round(o*this.WIDTH(!0)/this.WIDTH(!1)):o},TITLE_HEIGHT:32},Grid:{VERTICAL_SPACING:e=>e?16:12,HORIZONTAL_SPACING:e=>e?28:20,MARGIN:e=>e?50:45},GridTitle:{FONT_HEIGHT:17,MARGIN_HEIGHT:16},Bookmarks:{SIDEBAR_WIDTH:232}}),s<=0)throw new Error("tileHeight should be positive")}getSuggestedColumnCount(){const e=this.prefs.sidebarVisible?0:this.Sizes.Navbar.WIDTH,t=window.innerWidth-2*this.Sizes.Grid.MARGIN(this.prefs.useBiggerTiles)-e-this.Sizes.Scrollbar.WIDTH,i=Math.floor((t+this.Sizes.Grid.HORIZONTAL_SPACING(this.prefs.useBiggerTiles))/(this.Sizes.Tile.WIDTH(this.prefs.useBiggerTiles)+this.Sizes.Grid.HORIZONTAL_SPACING(this.prefs.useBiggerTiles))),s=this.prefs.adjustColumnsPref,o=s?6:this.prefs.speeddialColumnCountPref,r=Math.min(i,o);return s?2*Math.floor(r/2):r}getDimensions(e){const t=Math.max(this.MIN_COLUMN_COUNT,this.getSuggestedColumnCount()),i=this.getWidth(e),s=this.noWrap?this.MIN_ROW_COUNT:Math.max(this.MIN_ROW_COUNT,Math.ceil(e*(+this.doubleWidthTiles+1)/t)),o=this.getHeight(s),r=this.getWidth(t);return{columnCount:t,rowCount:s,width:i,height:o,containerWidth:r,outerContainerWidth:r+2*this.Sizes.Grid.MARGIN(this.prefs.useBiggerTiles)}}calculatePositions(e,t){const i=[];for(let s=0;s<e;s++){const e=this.doubleWidthTiles?2*s:s,o=e%t.columnCount,r=Math.floor(e/t.columnCount),n=o*(this.Sizes.Tile.WIDTH(this.prefs.useBiggerTiles)+this.Sizes.Grid.HORIZONTAL_SPACING(this.prefs.useBiggerTiles)),l=r*(this.Sizes.Tile.HEIGHT(this.prefs.useBiggerTiles)+this.Sizes.Tile.TITLE_HEIGHT+this.Sizes.Grid.VERTICAL_SPACING(this.prefs.useBiggerTiles));i.push({left:n,top:l})}return i}getWidth(e){return e*this.Sizes.Tile.WIDTH(this.prefs.useBiggerTiles)+(e-1)*this.Sizes.Grid.HORIZONTAL_SPACING(this.prefs.useBiggerTiles)}getHeight(e){return e*(this.Sizes.Tile.HEIGHT(this.prefs.useBiggerTiles)+this.Sizes.Tile.TITLE_HEIGHT)+(e-1)*this.Sizes.Grid.VERTICAL_SPACING(this.prefs.useBiggerTiles)}getSingleSDTileHeight(e){return this.Sizes.Tile.HEIGHT(e)}getSingleSDTileWidth(e){return this.doubleWidthTiles?2*this.Sizes.Tile.WIDTH(e)+this.Sizes.Grid.HORIZONTAL_SPACING(e):this.Sizes.Tile.WIDTH(e)}}}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports}(()=>{const e=i(250),t=i(671);function s(e,t={}){window.postMessage({type:"show_section_event",name:"TargetedSDSection_"+e,data:t},"chrome://startpage")}class o{constructor(e,t,i,o,r,n,l,a,c,d,h,u){this.rhMainContainer=e,this.sizeCalculator=t;let[p,g]=this.createRelativeRoot();e.appendChild(p);let m=this.createFoldableSection(o);g.appendChild(m),m.appendChild(this.createHeader(i,(()=>{s(m.classList.contains("folded")?"unfold":"fold"),m.classList.toggle("folded")})));const[T,f]=this.createTilesGrid(r);m.appendChild(T),m.appendChild(this.createIconsSection((t=>{e.innerHTML="",s("menu_option_clicked",{optionName:t})}),d,h,u)),window.addEventListener("resize",(()=>{this.layoutTiles(this.sizeCalculator,f,r,l,a)}));for(let e of["speeddial.bigger_tiles","speeddial.column_count","startpage.adjust_columns","ui.browser.sidebar.visible"])n.addListener(e,(()=>{this.layoutTiles(this.sizeCalculator,f,r,l,a)}));this.layoutTiles(this.sizeCalculator,f,r,l,a)}remove(){this.rhMainContainer.remove()}createTilesGrid(e){const t=document.createElement("div");t.className="content";const i=document.createElement("div");i.className="tiles-grid",i.style.left="0px",i.id="interest-driven-sd-grid",t.appendChild(i);for(let t of e){const e=this.createSDTile(t);i.appendChild(e),e.onclick=()=>{s("tile_clicked",{tileId:t.clickUrl})},e.onauxclick=e=>{1===e.button&&s("tile_clicked",{tileId:t.clickUrl})}}return t.style.width="auto",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",[t,i]}createIcon(e,t,i,s){let o=document.createElement("div");o.setAttribute("class",e);let r=o.attachShadow({mode:"open"}),n=document.createElement("style");n.innerText="@import url(chrome://op-resources/toolkit/../styleguide/common.css);\n      @import url(chrome://op-resources/toolkit/../styleguide/scrollbars.css);\n      @import url(chrome://op-resources/modules/styleguide/icon.css);",r.appendChild(n);let l=document.createElement("i");return l.classList.add("icon","dim"),l.style.webkitMaskImage=t,l.onclick=e=>{chrome.contextMenusPrivate.showMenu(e.clientX,e.clientY,s.map(((e,t)=>({type:chrome.contextMenusPrivate.ItemType.NORMAL,title:e,id:t,enabled:!0}))),(e=>{e<0||e>=s.length||i(s[e])})),e.stopImmediatePropagation(),e.preventDefault()},r.appendChild(l),[o,l]}createIconsSection(e,t,i,s){const o=document.createElement("section");if(o.className="icons",i&&(opr.feedbackPopupPrivate.showPopupWithDesc||opr.feedbackPopupPrivate.showPopup)){const[e,t]=this.createIcon("feedback",'url("chrome://op-resources/images/styleguide/feedback.svg")',(()=>{}),[]);opr.feedbackPopupPrivate.showPopupWithDesc?t.onclick=()=>function(e,t){const i=e.getBoundingClientRect();opr.feedbackPopupPrivate.showPopupWithDesc({topic:t,arrow:opr.feedbackPopupPrivate.Arrow.TOP_CENTER,frameSize:{height:Math.round(window.visualViewport.height),width:Math.round(window.visualViewport.width)},anchorBounds:{x:Math.round(i.x),y:Math.round(i.y),width:Math.round(i.width),height:Math.round(i.height)},anchorId:opr.feedbackPopupPrivate.AnchorId.PAGE,hideLearnMore:!0},(()=>{}))}(e,s):t.onclick=()=>function(e,t){const i=e.getBoundingClientRect();opr.feedbackPopupPrivate.showPopup(t,{height:Math.round(window.visualViewport.height),width:Math.round(window.visualViewport.width)},{x:Math.round(i.x),y:Math.round(i.y),width:Math.round(i.width),height:Math.round(i.height)},opr.feedbackPopupPrivate.Arrow.TOP_CENTER,opr.feedbackPopupPrivate.AnchorId.PAGE,(()=>{}))}(e,s),o.appendChild(e)}const[r]=this.createIcon("ellipsis",'url("chrome://op-resources/images/styleguide/ellipsis.svg")',e,t);o.appendChild(r);const[n]=this.createIcon("x-close",'url("chrome://op-resources/images/styleguide/close.svg")',e,t);return o.appendChild(n),o}createSDTile(e){const t=document.createElement("a");t.href=e.clickUrl,t.draggable=!1,t.className="tile",t.oncontextmenu=e=>{e.stopImmediatePropagation(),e.preventDefault()};const i=document.createElement("div");i.className="tile-main",t.appendChild(i);const s=document.createElement("div");s.className="tile-content",s.style.backgroundImage=`url(${e.imageUrl})`,i.appendChild(s);const o=document.createElement("div");o.className="tile-container",i.appendChild(o);const r=document.createElement("span");return r.className="title",r.innerText=e.title,r.style.justifyContent="center",o.appendChild(r),t}layoutTiles(e,t,i,s,o){const r=e.getDimensions(i.length);t.style.width=r.containerWidth+"px",t.style.height=r.height+"px";let n=e.calculatePositions(i.length,r);t.childNodes.forEach(((e,t)=>{e.style.transform=`translateX(${n[t].left}px) translateY(${n[t].top}px)`,o&&(e.style.display=t*(+s+1)>=r.columnCount?"none":"")}))}createTitleSpans(e){let t=[],i=`=${e}=`.split("*"),s=!1;for(let e of i){if(e=e.replace(/=/g,""),0===e.length)continue;const i=document.createElement("span");s&&(i.style.fontWeight="700"),i.innerText=e,t.push(i),s=!s}return t}createHeader(e,t){const i=document.createElement("h2");i.className="header",i.onclick=()=>t();const s=document.createElement("section");s.className="title",s.style.gap="0.3em";for(let t of this.createTitleSpans(e))s.appendChild(t);const o=document.createElement("span");o.className="chevron";const r=document.createElement("span");return r.className="chevron-icon",o.appendChild(r),s.appendChild(o),i.appendChild(s),i}createFoldableSection(e){const t=document.createElement("main");return t.className="foldable",e&&t.classList.toggle("folded"),t}createRelativeRoot(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"});e.style.position="relative";const i=document.createElement("style");return i.innerText=`@import url(chrome://op-resources/toolkit/../styleguide/common.css);\n      @import url(chrome://op-resources/toolkit/../styleguide/scrollbars.css);\n      @import url(chrome://op-resources/modules/rich_hint_container/rich_hint_container.css);\n      @import url(chrome://op-resources/modules/speeddial/components/speeddial.css);\n      @import url(chrome://op-resources/modules/startpage/components/tiles_grid.css);\n      @import url(chrome://op-resources/modules/startpage/components/tile.css);\n      @import url(chrome://op-resources/modules/styleguide/section.css);\n      :root.bigger-tiles, :host-context(html.bigger-tiles) {\n        --speeddial-tile-height: ${this.sizeCalculator.getSingleSDTileHeight(!0)}px;\n        --speeddial-tile-width: ${this.sizeCalculator.getSingleSDTileWidth(!0)}px;\n      }\n      :root, :host\n      {\n        --speeddial-tile-height: ${this.sizeCalculator.getSingleSDTileHeight(!1)}px;\n        --speeddial-tile-width: ${this.sizeCalculator.getSingleSDTileWidth(!1)}px;\n      }\n      .folded .ellipsis, .folded .feedback {\n        display: none;\n      }\n      .x-close {\n        display: none;\n      }\n      .folded .x-close {\n        display: block;\n      }\n      .icons { position: absolute; top: 0px; right: 0px; }\n      .folded .icons {\n        top: 9px; right: 10px;\n      }`,t.appendChild(i),[e,t]}static async create(e,t,i,s,r,n,l,a,c,d,h){if(!opr.startpageHintsPrivate){let e=-1;try{await new Promise(((t,i)=>{let s=0;e=window.setInterval((()=>{opr.startpageHintsPrivate?t():(++s,s>10&&i())}),100)}))}finally{window.clearInterval(e)}}const u=await new Promise((e=>{opr.startpageHintsPrivate.showSection("below-search",(t=>e(t)))}));if(u.innerHTML="",0!==i.length)return new o(u,e,t,s,i,r,n,l,a,c,d,h)}}window.addEventListener("message",(function(i){"show_section"===i.data.type&&async function(i){let s=await e.Prefs.make(),r=new t.StartpageGridSizeCalculator(s,i.doubleWidthTiles,i.noWrap,i.tileHeight);document.targetedSdSectionUi=await o.create(r,i.sectionTitle,i.tiles,i.folded,s,i.doubleWidthTiles,i.noWrap,i.tileHeight,i.closeMenuOptionNames,i.feedbackEnabled,i.campaignId),window.postMessage({type:"show_section_done"},"chrome://startpage")}(i.data),"agent_disconnected"===i.data.type&&document.targetedSdSectionUi&&document.targetedSdSectionUi.remove()}))})()})();