(()=>{"use strict";var e={100:e=>{var t,a="object"==typeof Reflect?Reflect:null,s=a&&"function"==typeof a.apply?a.apply:function(e,t,a){return Function.prototype.apply.call(e,t,a)};t=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(a,s){function r(a){e.removeListener(t,i),s(a)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",r),a([].slice.call(arguments))}v(e,t,i,{once:!0}),"error"!==t&&function(e,t,a){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,r)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var n=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,a,s){var r,i,n,l;if(o(a),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,a.listener?a.listener:a),i=e._events),n=i[t]),void 0===n)n=i[t]=a,++e._eventsCount;else if("function"==typeof n?n=i[t]=s?[a,n]:[n,a]:s?n.unshift(a):n.push(a),(r=c(e))>0&&n.length>r&&!n.warned){n.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=n.length,l=d,console&&console.warn&&console.warn(l)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,a){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:a},r=d.bind(s);return r.listener=a,s.wrapFn=r,r}function u(e,t,a){var s=e._events;if(void 0===s)return[];var r=s[t];return void 0===r?[]:"function"==typeof r?a?[r.listener||r]:[r]:a?function(e){for(var t=new Array(e.length),a=0;a<t.length;++a)t[a]=e[a].listener||e[a];return t}(r):g(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var a=t[e];if("function"==typeof a)return 1;if(void 0!==a)return a.length}return 0}function g(e,t){for(var a=new Array(t),s=0;s<t;++s)a[s]=e[s];return a}function v(e,t,a,s){if("function"==typeof e.on)s.once?e.once(t,a):e.on(t,a);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(i){s.once&&e.removeEventListener(t,r),a(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return n},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");n=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],a=1;a<arguments.length;a++)t.push(arguments[a]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var n;if(t.length>0&&(n=t[0]),n instanceof Error)throw n;var o=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw o.context=n,o}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var l=c.length,d=g(c,l);for(a=0;a<l;++a)s(d[a],this,t)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},i.prototype.removeListener=function(e,t){var a,s,r,i,n;if(o(t),void 0===(s=this._events))return this;if(void 0===(a=s[e]))return this;if(a===t||a.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,a.listener||t));else if("function"!=typeof a){for(r=-1,i=a.length-1;i>=0;i--)if(a[i]===t||a[i].listener===t){n=a[i].listener,r=i;break}if(r<0)return this;0===r?a.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(a,r),1===a.length&&(s[e]=a[0]),void 0!==s.removeListener&&this.emit("removeListener",e,n||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,a,s;if(void 0===(a=this._events))return this;if(void 0===a.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==a[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete a[e]),this;if(0===arguments.length){var r,i=Object.keys(a);for(s=0;s<i.length;++s)"removeListener"!==(r=i[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=a[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},i.prototype.listeners=function(e){return u(this,e,!0)},i.prototype.rawListeners=function(e){return u(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},i.prototype.listenerCount=p,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},793:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Adblock=void 0;const a="adblocker.enabled";class s{constructor(e){this.variableStore=e,void 0!==chrome.settingsPrivate&&(chrome.settingsPrivate.getPref(a,(e=>{this.variableStore.setInt("adblocker_enabled",e.value?1:0)})),chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.forEach((e=>{e.key===a&&this.variableStore.setInt("adblocker_enabled",e.value?1:0)}))})))}static registerVariables(e){e.registerIntVariable("adblocker_enabled",0)}}t.Adblock=s,s.VARIABLES={adblocker_enabled:{default:0,description:"Whether the adblocker is enabled"}}},923:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AIToolsEventSource=void 0;const a="ui.ai_tools.enabled";class s{constructor(e){this.fireEvent=e}async listenerUpdate(){chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.forEach((async e=>{var t;e.key===a&&await(t=a,new Promise(((e,a)=>{chrome.settingsPrivate.getPref(t,(s=>{chrome.runtime.lastError?a(chrome.runtime.lastError):s.type!==chrome.settingsPrivate.PrefType.BOOLEAN?a("Wrong "+t+" type"):e(s.value)}))})))&&this.fireEvent({eventName:s.EVENT_SOURCE_NAME})}))}))}async activate(){this.listenerUpdate()}async deactivate(){}}t.AIToolsEventSource=s,s.EVENT_SOURCE_NAME="ai_tools_enabled"},896:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AriaEventSource=void 0;class a{constructor(e){this.variableStore=e}async fireEvent(){await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME},e)))}static registerVariables(e){e.registerIntVariable("aria_access_granted",this.VARIABLES.aria_access_granted.default)}onAriaMessage(e,t,a){"show-richhint"===e.cmd&&"aria-access-granted"===e.type&&(this.fireEvent(),this.variableStore.setInt("aria_access_granted",1),a({status:"OK"}))}async activate(){chrome.runtime.onMessageExternal.addListener(this.onAriaMessage.bind(this))}async deactivate(){chrome.runtime.onMessageExternal.removeListener(this.onAriaMessage)}}t.AriaEventSource=a,a.EVENT_SOURCE_NAME="aria-access",a.VARIABLES={aria_access_granted:{default:0,description:"Whether the aria access was granted"}}},866:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reloadStartpagesInAllWindowsWhenInBackground=void 0;class a{constructor(e){this.onStartpageInWindowReloaded=e,this.windowsToWaitFor=new Set,this.tabActivatedListener=e=>this.onTabActivated(e),this.tabUpdatedListener=(e,t,a)=>this.onTabUpdated(e,t,a),this.windowRemovedListener=e=>this.onWindowRemoved(e),(async()=>{var e;const t=await new Promise((e=>chrome.windows.getAll((t=>e(t.filter((e=>"normal"===e.type||"popup"===e.type))))))),a=await Promise.all(t.map((e=>new Promise((t=>{chrome.tabs.query({active:!0,windowId:e.id},(a=>t({windowId:e.id,activeTab:a[0]})))})))));for(const t of a)(null===(e=t.activeTab.url)||void 0===e?void 0:e.startsWith("chrome://startpage"))?this.windowsToWaitFor.add(t.windowId):opr.speeddialPrivate.reloadInWindow(t.windowId,(()=>{}));0!==this.windowsToWaitFor.size&&(chrome.tabs.onActivated.addListener(this.tabActivatedListener),chrome.tabs.onUpdated.addListener(this.tabUpdatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener))})()}onTabActivated(e){this.windowsToWaitFor.has(e.windowId)&&chrome.tabs.get(e.tabId,(e=>{this.reloadStartpageIfInBackground(e.windowId,e.url)}))}onTabUpdated(e,t,a){this.windowsToWaitFor.has(a.windowId)&&a.active&&t.url&&this.reloadStartpageIfInBackground(a.windowId,a.url)}onWindowRemoved(e){this.windowsToWaitFor.delete(e),this.onWindowHandled(e)}reloadStartpageIfInBackground(e,t){t.startsWith("chrome://startpage")||(opr.speeddialPrivate.reloadInWindow(e,(()=>{this.onStartpageInWindowReloaded(e)})),this.onWindowHandled(e))}onWindowHandled(e){this.windowsToWaitFor.delete(e),0===this.windowsToWaitFor.size&&(chrome.tabs.onActivated.removeListener(this.tabActivatedListener),chrome.tabs.onUpdated.removeListener(this.tabUpdatedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener))}}t.reloadStartpagesInAllWindowsWhenInBackground=function(e){new a(e)}},792:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserLaunchedWithTagAssigned=void 0;class a{constructor(e){this.backend=e}static eventNameForTag(e){return`browser-launched-with-tag-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:a.eventNameForTag(this.backend.tagName)})}async activate(){await this.backend.wasRecentlyLaunchedWithTag()&&this.fireEvent()}async deactivate(){}}t.BrowserLaunchedWithTagAssigned=a},314:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.CashbackBadgeShownEventSource=void 0,function(e){e[e.INITIALIZING_WINDOW=0]="INITIALIZING_WINDOW",e[e.COMPUTING_IF_COMMIT_CHECK_NEEDED=1]="COMPUTING_IF_COMMIT_CHECK_NEEDED",e[e.WATING_FOR_TAB_COMMIT=2]="WATING_FOR_TAB_COMMIT",e[e.IDLE=3]="IDLE"}(a||(a={}));class s{constructor(e){this.windowCreatedClosures=[],this._state=a.INITIALIZING_WINDOW,this._state=e?a.IDLE:a.INITIALIZING_WINDOW}get hasWindowData(){return this._state!==a.INITIALIZING_WINDOW}get computingIfCommitCheckNeeded(){return this._state===a.COMPUTING_IF_COMMIT_CHECK_NEEDED}get waitingForTabCommit(){return this._state===a.WATING_FOR_TAB_COMMIT}onWindowCreated(){var e;this._state=a.IDLE;for(const t of null!==(e=this.windowCreatedClosures)&&void 0!==e?e:[])t();this.windowCreatedClosures=[]}onComputingIfCommitCheckNeeded(){this._state=a.COMPUTING_IF_COMMIT_CHECK_NEEDED}waitForTabCommit(e){this._state=a.WATING_FOR_TAB_COMMIT;let t=this.stateClosure;this.stateClosure=e,t&&t()}onIdle(){this._state=a.IDLE}commitTab(){this._state=a.IDLE,this.stateClosure&&this.stateClosure(),this.stateClosure=void 0}addWindowReadyClosure(e){this.windowCreatedClosures.push(e)}setStateClosure(e){this.stateClosure=e}}class r{constructor(e){this.variableStore=e,this.cashbackStatesForWindows=new Map,this.cashbackBadgeStateChangedListener=(e,t)=>this.onCashbackStateChanged(e,t),this.windowCreatedListener=e=>this.onWindowCreated(e),this.windowRemovedListener=e=>this.onWindowRemoved(e),this.tabActivatedListener=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.cashbackPrivate}static registerVariables(e){e.registerStringVariable("page_with_cashback",this.VARIABLES.page_with_cashback.default)}getWindowState(e){let t=this.cashbackStatesForWindows.get(e);return t||(t={supported:!1,state:opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new s(!1)},this.cashbackStatesForWindows.set(e,t),t)}getTabInfo(e){return new Promise((t=>{chrome.tabs.query(e,(e=>{t(e[0])}))}))}getCashbackBadgeState(e){return new Promise((t=>opr.cashbackPrivate.getCashbackBadgeState(e,t)))}async onCashbackStateChanged(e,t){const a=this.getWindowState(e);if(!a.stateManager.hasWindowData)return void a.stateManager.addWindowReadyClosure((()=>this.onCashbackStateChanged(e,t)));if(!a.supported)return;a.stateManager.onComputingIfCommitCheckNeeded();const s=await this.getTabInfo({active:!0,windowId:e});let r=()=>a.stateManager.onIdle();try{if(void 0===s)return void a.stateManager.onIdle();if(a.lastKnownActiveTabId!==s.id)return void(r=()=>a.stateManager.waitForTabCommit((()=>this.onCashbackStateChanged(e,t))));a.state===opr.cashbackPrivate.BadgeState.DISABLED&&t!==opr.cashbackPrivate.BadgeState.DISABLED&&await this.fireEvent(s.url),a.state=t}finally{r()}}onWindowCreated(e){const t=this.getWindowState(e.id);t.supported="normal"===e.type&&!e.incognito,t.stateManager.onWindowCreated()}onWindowRemoved(e){this.cashbackStatesForWindows.delete(e)}async onTabActivated(e){const t=this.getWindowState(e.windowId);if(t.stateManager.hasWindowData){if(t.supported)if(t.stateManager.computingIfCommitCheckNeeded)t.stateManager.setStateClosure((()=>this.onTabActivated(e)));else try{if(t.stateManager.waitingForTabCommit)return;const a=await this.getCashbackBadgeState(e.windowId);if(t.state=a,a===opr.cashbackPrivate.BadgeState.DISABLED)return;const s=await new Promise((t=>chrome.tabs.get(e.tabId,t)));await this.fireEvent(s.url)}finally{t.lastKnownActiveTabId=e.tabId,t.stateManager.commitTab()}}else t.stateManager.addWindowReadyClosure((()=>this.onTabActivated(e)))}async fireEvent(e){await this.variableStore.setString("page_with_cashback",e),await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:r.EVENT_SOURCE_NAME},e)))}async activate(){const e=await new Promise((e=>chrome.windows.getAll(e)));chrome.tabs.onActivated.addListener(this.tabActivatedListener),this.cashbackStatesForWindows=new Map(await Promise.all(e.map((e=>new Promise((async t=>{const a="normal"===e.type&&!e.incognito;t([e.id,{supported:a,state:a?await new Promise((t=>{opr.cashbackPrivate.getCashbackBadgeState(e.id,t)})):opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new s(!0)}])})))))),chrome.windows.onCreated.addListener(this.windowCreatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.addListener(this.cashbackBadgeStateChangedListener)}async deactivate(){chrome.tabs.onActivated.removeListener(this.tabActivatedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.removeListener(this.cashbackBadgeStateChangedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener),chrome.windows.onCreated.removeListener(this.windowCreatedListener)}}t.CashbackBadgeShownEventSource=r,r.EVENT_SOURCE_NAME="cashback-badge-shown",r.VARIABLES={page_with_cashback:{default:"none",description:"Page that generated the cashback-badge-shown event"}}},497:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.CategoryEventSource=void 0,function(e){e.WORK="work",e.ENTERTAINMENT="entertainment",e.GAMING="gaming",e.TRAVEL="travel",e.SPORT="sport",e.SHOPPING="shopping",e.OTHER="other"}(a||(a={}));const s={work:["google.com","microsoft.com","live.com","outlook.com"],entertainment:["apple.com/apple-music/","archiveofourown.org","biletyna.pl","bonito.pl","cda.pl","discogs.com","disneyplus.com","ebilet.pl","empik.com","eska.pl","eventbrite.de","eventim.de","eventim.pl","filmweb.pl","genius.com","hbomax.com","hulu.com","imdb.com","kupbilecik.pl","legimi.pl","lubimyczytac.pl","nbc.com","ndr.de","netflix.com","overdrive.com","primevideo.com","publio.pl","radiozet.pl","rmffm.pl","soundcloud.com","spotify.com","tekstowo.pl","thomann.de","ticketmaster.de","ticketmaster.pl","viagogo.de","wattpad.com","woblink.com","worldstar.com","youtube.com","zdf.de"],gaming:["browsergames.de","buffed.de","computerbild.de/spiele/news","cybersport.pl","dekudeals.com","eneba.com","esportnow.pl","g2a.com/pl","gameduell.de/gd","gameforge.com/de-de","gamestar.de/news","gamingsociety.pl","gg.deals","giga.de/games/news","gry-online.pl","ign.com","inside-digital.de/entertainment/news/gaming-news","kinguin.net","lowcygier.pl","metacritic.com/game","miastogier.pl","pl.egamersworld.com","planetagracza.pl","prosiebengames.de","psdeals.net","theverge.com/games","xbdeals.net"],travel:["aa.com","aerotelegraph.de","airbnb.com","airbnb.de","airbnb.pl","avis.com","billiger-mietwagen.de","blablacar.de","blablacar.pl","booking.com","budget.com","carfree.pl","delta.com","discovercars.com","e-podroznik.pl","enterprise.com","europcar.de","eurowings.com","expedia.com","fewo-direkt.de","fly4free.pl","getyourguide.com","hamburg.de","hertz.com","holidaycheck.de","hometogo.de","intercity.pl","itaka.pl","jetblue.com","kayak.com","lot.com","lufthansa.com","marriott.com","noclegi.pl","profitroom.com","rentalcars.com","rentalcars.de","rozklad-pkp.pl","ryanair.com","sixt.de","skyscanner.de","skyscanner.pl","southwest.com","travelbook.de","travelerdreams.com","tripadvisor.com","tripadvisor.de","trivago.de","trivago.pl","tui.com","united.com","universalorlando.com","viator.com","vrbo.com","wakacje.pl","wizzair.com"],sport:["247sports.com","bet365.de","betfan.pl/zaklady-bukmacherskie","betonline.ag","betus.com.pa","cbssports.com","dazn.com","efortuna.pl","espn.com","eurosport.de","eurosport.tvn24.pl","flashscore.com","flashscore.de","flashscore.pl","kicktipp.de","lephaush.net","livescore.com","lvbet.pl/pl","mybookie.ag","nbcsports.com","sofascore.com","sport.bild.de","sport.interia.pl","sport.pl","sport.tvp.pl","sport1.de","sports.tipico.de","sports.yahoo.com","sportschau.de","sts.pl","superbet.pl/intro","tipico.de","topnewsfeeds.net"],shopping:["adcell.com","alerabat.com","allegro.pl","allegrolokalnie.pl","amazon.com","amazon.pl","bizrate.com","ceneo.pl","coolblue.de","ebay-kleinanzeigen.de","ebay.com","empik.com","geizhals.de","groupon.com","groupon.de","groupon.pl","hereswhatstrending.com","idealo.de","ikea.com/pl/pl","kaufda.de","letyshops.com","markt.de","michaels.com","mydealz.de","offerup.com","okazje.info.pl","okazjum.pl","olx.pl","otomoto.pl","pepper.pl","poshmark.com","prospektangebote.de","prospektmaschine.de","qvc.com","searchiqnet.com","skapiec.pl","slickdeals.net","swagbucks.com","thalia.de","tradechaser.com"]};class r{constructor(e,t,a,s){this.fireEvent=e,this.onTabUpdated=t,this.onTabRemoved=a,this.variableStore=s,this.tabsWithCategory=new Map,this.categoryCounters=new Map}static registerVariables(e){e.registerStringVariable("category",this.VARIABLES.category.default)}findCategory(e){return void 0===e?a.OTHER:s.entertainment.find((t=>e.includes(t)))?a.ENTERTAINMENT:s.work.find((t=>e.includes(t)))?a.WORK:s.gaming.find((t=>e.includes(t)))?a.GAMING:s.travel.find((t=>e.includes(t)))?a.TRAVEL:s.sport.find((t=>e.includes(t)))?a.SPORT:s.shopping.find((t=>e.includes(t)))?a.SHOPPING:a.OTHER}async listenerUpdate(e,t,s){if(void 0===t.status||"loading"!==t.status)return;const i=this.findCategory(s.url),n=this.tabsWithCategory.get(e);if(void 0!==n&&this.categoryCounters.get(n)){const e=this.categoryCounters.get(n);e&&this.categoryCounters.set(n,Math.max(e-1,0))}const o=this.categoryCounters.get(i)?this.categoryCounters.get(i)+1:1;this.categoryCounters.set(i,o),this.tabsWithCategory.set(e,i),o>=r.NUMBER_OF_TABS_TO_TRIGGER_EVENT&&i!==a.OTHER&&(this.categoryCounters.set(i,0),this.variableStore.setString("category",i),this.fireEvent({eventName:r.EVENT_SOURCE_NAME,windowId:s.windowId}))}async listenerRemove(e){const t=this.tabsWithCategory.get(e);if(void 0!==t){const a=this.categoryCounters.get(t);void 0!==a&&a>0&&this.categoryCounters.set(t,a-1),this.tabsWithCategory.delete(e)}}async activate(){this.listenerUpdateObject=this.listenerUpdate.bind(this),this.onTabUpdated.addListener(this.listenerUpdateObject),this.listenerRemoveObject=this.listenerRemove.bind(this),this.onTabRemoved.addListener(this.listenerRemoveObject)}async deactivate(){this.onTabUpdated.removeListener(this.listenerUpdateObject),this.listenerUpdateObject=null,this.onTabRemoved.removeListener(this.listenerRemoveObject),this.listenerRemoveObject=null}}t.CategoryEventSource=r,r.NUMBER_OF_TABS_TO_TRIGGER_EVENT=3,r.VARIABLES={category:{default:"unknown",description:"Current category by number of open tabs (work, entertainment, gaming, travel, sport, shopping)"}},r.EVENT_SOURCE_NAME="category"},618:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CheckoutPageEventSource=void 0;class a{constructor(e){this.variableStore=e,this.tabsWithForms=new Map,this.autofillFormDetectedCallback=(e,t)=>this.onAutofillFormDetected(e,t),this.tabsUpdatedCallback=(e,t,a)=>this.onTabsUpdated(e,t,a),this.tabsActivatedCallback=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.richHintsAgentPrivate.onAutofillFormDetected}static registerVariables(e){e.registerStringVariable("page_with_checkout_form",this.VARIABLES.page_with_checkout_form.default)}async activate(){opr.richHintsAgentPrivate.onAutofillFormDetected.addListener(this.autofillFormDetectedCallback),chrome.tabs.onActivated.addListener(this.tabsActivatedCallback),chrome.tabs.onUpdated.addListener(this.tabsUpdatedCallback)}async deactivate(){opr.richHintsAgentPrivate.onAutofillFormDetected.removeListener(this.autofillFormDetectedCallback),chrome.tabs.onActivated.removeListener(this.tabsActivatedCallback),chrome.tabs.onUpdated.removeListener(this.tabsUpdatedCallback)}async fireEvent(e,t){await this.variableStore.setString("page_with_checkout_form",t),opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME,windowId:e})}onAutofillFormDetected(e,t){this.isCheckoutFormHeuristics(t)&&chrome.tabs.get(e,(t=>{this.tabsWithForms.set(e,t.url),t.active&&this.fireEvent(t.windowId,t.url)}))}onTabsUpdated(e,t,a){t.url&&this.tabsWithForms.delete(e)}onTabActivated(e){const t=this.tabsWithForms.get(e.tabId);t&&this.fireEvent(e.windowId,t)}isCheckoutFormHeuristics(e){return e.fields.find((e=>e.type===opr.richHintsAgentPrivate.AutofillFieldType.CREDIT_CARD_NUMBER))&&e.fields.map((e=>e.group===opr.richHintsAgentPrivate.AutofillFieldGroup.CREDIT_CARD?1:0)).reduce(((e,t)=>e+t))>=2}}t.CheckoutPageEventSource=a,a.EVENT_SOURCE_NAME="checkout-page",a.VARIABLES={page_with_checkout_form:{default:"none",description:"Page that generated the checkout-page event"}}},862:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClockEventSource=t.AgentClock=void 0;const s=a(100);class r{constructor(e){this.variableStore=e,this.sessionStartTime=-1,this.eventEmitter=new s.EventEmitter}static registerVariables(e){e.registerIntVariable("minutes_since_startup",this.VARIABLES.minutes_since_startup.default)}onMinutePassed(e){this.eventEmitter.on("minute-passed",e)}setOnBeforeMinutePassedBarrier(e){this.onBeforeMinutePassedBarrier=e}removeCallback(e){this.eventEmitter.removeListener("minute-passed",e)}async init(e){const t=await new Promise((e=>chrome.storage.local.get("session_data",(t=>{var a;return e(null!==(a=t.session_data)&&void 0!==a?a:{})}))));this.sessionStartTime=await(async()=>("extension_update"===e&&"number"==typeof t.sessionStartTime||(t.sessionStartTime=Date.now(),await new Promise((e=>chrome.storage.local.set({session_data:t},e)))),t.sessionStartTime))(),window.setInterval((()=>this.minutePassedHandler()),6e4),this.minutePassedHandler()}async minutePassedHandler(){const e=Math.round((Date.now()-this.sessionStartTime)/6e4);this.variableStore.setInt("minutes_since_startup",e),this.onBeforeMinutePassedBarrier&&await this.onBeforeMinutePassedBarrier(),this.eventEmitter.emit("minute-passed")}}t.AgentClock=r,r.VARIABLES={minutes_since_startup:{default:0,description:"Time since Opera launched"}};class i{constructor(e){this.clock=e,this.minutePassedCallback=()=>this.onMinutePassed()}async activate(){this.clock.onMinutePassed(this.minutePassedCallback)}async deactivate(){this.clock.removeCallback(this.minutePassedCallback)}onMinutePassed(){opr.richHintsAgentPrivate.fireEvent({eventName:i.EVENT_SOURCE_NAME})}}t.ClockEventSource=i,i.EVENT_SOURCE_NAME="minute-passed"},257:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0,t.Constants=class{constructor(e){this.productType=e}static async getProductType(){if(opr.operaBrowserPrivate)switch(await new Promise((e=>opr.operaBrowserPrivate.getProduct(e)))){case"Opera Crypto":return"crypto";case"Opera GX":return"gx";case"Opera":return"opera";default:return}}}},868:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayTargetedSDSectionFunctionMessage=t.CallTestStartpageFunctionMessage=t.ACS_CallStartpageFunctionMessage=t.ACS_UseApiMessage=t.ContentScriptMessageWithApiType=t.ACS_ErrorMessage=t.CSA_StartpageAPIEventMessage=t.CSA_CallStartpageFunctionResponseMessage=t.ApiToContentScriptMessage=t.ContentScriptToApiMessage=t.ContentScriptConnectionMessage=void 0;class a{constructor(e,t){this.type=e,this.requestId=t,this.id=a.nextId++}}t.ContentScriptConnectionMessage=a,a.nextId=0;class s extends a{}t.ContentScriptToApiMessage=s;class r extends a{}t.ApiToContentScriptMessage=r;class i extends s{constructor(e,t,a){super("CSA_CallStartpageFunctionResponse",t),this.result=e,this.data=a}static fromRawMessage(e){if("CSA_CallStartpageFunctionResponse"!==e.type||"boolean"!=typeof e.result||"number"!=typeof e.requestId||"object"!=typeof e.data)throw new Error("Unparseable message");return new i(e.result,e.requestId,e.data)}}t.CSA_CallStartpageFunctionResponseMessage=i;class n extends s{constructor(e,t,a){super("CSA_StartpageAPIEvent"),this.result=e,this.name=t,this.data=a}static fromRawMessage(e){if("CSA_StartpageAPIEvent"!==e.type||"string"!=typeof e.name||"object"!=typeof e.data)throw new Error("Unparseable message");return new n(e.result,e.name,e.data)}}t.CSA_StartpageAPIEventMessage=n,t.ACS_ErrorMessage=class extends r{constructor(e){super("ACS_Error"),this.message=e}};class o extends r{constructor(e,t,a){super(e,a),this.functionName=t}}t.ContentScriptMessageWithApiType=o;class c extends o{constructor(e,t,a,s){super(e,t,a),this.params=s}}t.ACS_UseApiMessage=c;class l extends c{constructor(e,t,a,s){super(l.MESSAGE_TYPE,e,t,s),this.windowId=a}}t.ACS_CallStartpageFunctionMessage=l,l.MESSAGE_TYPE="ACS_CallStartpageFunction";class d extends l{constructor(e,t,a,s){super("TestStartpageFunction",e,t,{boxColour:a,text:s})}get boxColour(){return this.params.boxColour}get text(){return this.params.text}static fromParams(e,t,a){const s=a.get("colour");if("string"!=typeof s)throw new Error(`Bad colour ${s}`);const r=a.get("text");if("string"!=typeof s)throw new Error(`Bad colour ${s}`);return new d(e,t,s,r)}static fromRawMessage(e){if("object"!=typeof e.params)throw new Error("params not an object");if("string"!=typeof e.params.boxColour)throw new Error("boxColour not a string");if("string"!=typeof e.params.text)throw new Error("text not a string");return new d(e.requestId,e.windowId,e.params.boxColour,e.params.text)}}t.CallTestStartpageFunctionMessage=d;class h extends l{constructor(e,t,a,s,r,i,n,o,c,l,d){super("DisplayTargetedSDSection",e,t,{tiles:a,sectionTitle:s,folded:r,doubleWidthTiles:i,noWrap:n,tileHeight:o,closeMenuOptionNames:c,feedbackEnabled:l,campaignId:d}),this.tiles=a,this.sectionTitle=s,this.folded=r,this.doubleWidthTiles=i,this.noWrap=n,this.tileHeight=o,this.closeMenuOptionNames=c,this.feedbackEnabled=l,this.campaignId=d}static createTilesFromArray(e){let t=[];for(let a of e){if("string"!=typeof a.clickUrl)throw new Error("tiles[i].clickUrl must be a string");if("string"!=typeof a.imageUrl)throw new Error("tiles[i].imageUrl must be a string");if("string"!=typeof a.title)throw new Error("tiles[i].title must be a string");t.push({clickUrl:a.clickUrl,imageUrl:a.imageUrl,title:a.title})}return t}static fromParams(e,t,a){const s=a.get("tiles");if(!(s instanceof Array))throw new Error("tiles should be an array");const r=a.get("sectionTitle");if("string"!=typeof r)throw new Error("sectionTitle should be a string");const i=a.get("folded");if("boolean"!=typeof i)throw new Error("folded should be a boolean");const n=a.get("doubleWidthTiles");if("boolean"!=typeof n)throw new Error("doubleWidthTiles should be a boolean");const o=a.get("noWrap");if("boolean"!=typeof o)throw new Error("noWrap should be a boolean");const c=a.get("tileHeight");if("number"!=typeof c)throw new Error("tileHeight should be a number");const l=a.get("closeMenuOptionNames");if(l instanceof Array&&l.some((e=>"string"!=typeof e)))throw new Error("closeMenuOptionNames should be a string array");const d=a.get("feedbackEnabled");if("boolean"!=typeof d)throw new Error("feedbackEnabled should be a boolean");const u=a.get("campaignId");if("string"!=typeof u)throw new Error("campaignId should be a string");return new h(e,t,h.createTilesFromArray(s),r,i,n,o,c,l,d,u)}static fromRawMessage(e){if("object"!=typeof e.params)throw new Error("params not an object");if(!(e.params.tiles instanceof Array))throw new Error("params.tiles not an array");if("string"!=typeof e.params.sectionTitle)throw new Error("sectionTitle should be a string");if("boolean"!=typeof e.params.folded)throw new Error("folded should be a boolean");if("boolean"!=typeof e.params.doubleWidthTiles)throw new Error("doubleWidthTiles should be a boolean");if("boolean"!=typeof e.params.noWrap)throw new Error("noWrap should be a boolean");if("number"!=typeof e.params.tileHeight)throw new Error("tileHeight should be a number");if(e.params.closeMenuOptionNames instanceof Array&&e.params.closeMenuOptionNames.some((e=>"string"!=typeof e)))throw new Error("closeMenuOptionNames should be a string array");if("boolean"!=typeof e.params.feedbackEnabled)throw new Error("feedbackEnabled should be a boolean");if("string"!=typeof e.params.campaignId)throw new Error("campaignId should be a string");return new h(e.requestId,e.windowId,h.createTilesFromArray(e.tiles),e.params.sectionTitle,e.params.folded,e.params.doubleWidthTiles,e.params.noWrap,e.params.tileHeight,e.params.closeMenuOptionNames,e.params.feedbackEnabled,e.params.campaignId)}}t.DisplayTargetedSDSectionFunctionMessage=h},114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorReporter=void 0,t.ErrorReporter=class{constructor(){opr.richHintsAgentPrivate.reportFeedback&&(window.addEventListener("error",(e=>this.onUncaughtError(e.error))),window.addEventListener("unhandledrejection",(e=>this.onUnhandledRejection(e.reason))))}onUncaughtError(e){this.reportError("string"==typeof e?e:e.message)}onUnhandledRejection(e){this.reportError("string"==typeof e?e:e.message)}reportError(e){e&&opr.richHintsAgentPrivate.reportFeedback(opr.richHintsAgentPrivate.FeedbackType.ERROR,""+e)}}},304:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventRegistry=void 0;const s=a(100);t.EventRegistry=class{constructor(e,t,a){this.onSpecificationUpdated=e,this.provideEvents=t,this.eventSourceFactory=a,this.eventsSources=new Map,this.eventEmitter=new s.EventEmitter,this.onSpecificationUpdated.addListener((()=>{this.registerEvents()}))}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}registerEvents(){this.eventEmitter.emit("start-providing-events"),this.provideEvents(this.eventSourceFactory.getSupportedEvents(),(e=>{let t=Array.from(this.eventsSources.keys()),a=e.filter((e=>-1===t.indexOf(e))),s=t.filter((t=>-1===e.indexOf(t)));a.forEach((e=>{let t=this.eventSourceFactory.createEventSource(e);t?(this.eventsSources.set(e,t),t.activate(this)):console.warn("The event "+t+" is unknown and cannot be handled")})),s.forEach((e=>{this.eventsSources.get(e).deactivate(this),this.eventsSources.delete(e)}))}))}}},267:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceFactoryImpl=void 0,t.EventSourceFactoryImpl=class{constructor(e){this.eventFactories=e}createEventSource(e){let t=this.eventFactories.get(e);return t?t():null}getSupportedEvents(){return Array.from(this.eventFactories.keys())}}},105:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkExtensionLaunchType=void 0,t.checkExtensionLaunchType=async function(){const e=await new Promise((e=>chrome.storage.local.get("launch_type_check",(t=>{var a;return e(null!==(a=t.launch_type_check)&&void 0!==a?a:{})})))),t=chrome.runtime.getManifest().version,a=void 0===e.last_recorded_version?"first_install":e.last_recorded_version===t?"browser_launch":"extension_update";return e.last_recorded_version=t,await new Promise((t=>chrome.storage.local.set({launch_type_check:e},t))),a}},561:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionPromotions=void 0;class a{constructor(e){[{id:a.ALITOOLS_EXTENSION_ID,variableNames:{has:a.HAS_ALITOOLS_VARIABLE_NAME,uninstalled:a.UNINSTALLED_ALITOOLS_VARIABLE_NAME}},{id:a.AMAZON_EXTENSION_ID,variableNames:{has:a.HAS_AMAZON_VARIABLE_NAME,uninstalled:a.UNINSTALLED_AMAZON_VARIABLE_NAME}}].forEach((t=>{chrome.management.get(t.id,(()=>{e.setInt(t.variableNames.has,void 0===chrome.runtime.lastError?1:0)})),chrome.management.onInstalled.addListener((a=>{t.id===a.id&&e.setInt(t.variableNames.has,1)})),chrome.management.onUninstalled.addListener((a=>{t.id===a&&(e.setInt(t.variableNames.has,0),e.setInt(t.variableNames.uninstalled,1))}))}))}static registerVariables(e){e.registerIntVariable(a.UNINSTALLED_ALITOOLS_VARIABLE_NAME,a.VARIABLES.uninstalled_alitools.default),e.registerIntVariable(a.UNINSTALLED_AMAZON_VARIABLE_NAME,a.VARIABLES.uninstalled_amazon.default),e.registerIntVariable(a.HAS_ALITOOLS_VARIABLE_NAME,a.VARIABLES.has_alitools.default),e.registerIntVariable(a.HAS_AMAZON_VARIABLE_NAME,a.VARIABLES.has_amazon.default)}}t.ExtensionPromotions=a,a.VARIABLES={has_alitools:{default:0,description:"Whether Alitools is currently installed"},has_amazon:{default:0,description:"Whether the Amazon assistant is currently installed"},uninstalled_alitools:{default:0,description:"Whether Alitools has ever been uninstalled"},uninstalled_amazon:{default:0,description:"Whether the Amazon assistant has ever been uninstalled"}},a.ALITOOLS_EXTENSION_ID="nkekkheibgkgeepapinkalkongndfajn",a.AMAZON_EXTENSION_ID="mmmbddcnnndpbdflpccgcknaaabgldak",a.HAS_ALITOOLS_VARIABLE_NAME="has_alitools",a.HAS_AMAZON_VARIABLE_NAME="has_amazon",a.UNINSTALLED_ALITOOLS_VARIABLE_NAME="uninstalled_alitools",a.UNINSTALLED_AMAZON_VARIABLE_NAME="uninstalled_amazon"},534:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalConnectionBroker=t.defaultExternalConnectionPortFactory=t.ExternalConnectionPort=void 0;const s=a(100),r=a(725);class i{constructor(e,t,a){this.rawPort=t,this.portId=a,this.eventEmitter=new s.EventEmitter,t.onMessage.addListener((t=>{try{const a=e.parse(t);a.port=this,this.eventEmitter.emit("message",a)}catch(e){this.postMessage(new r.AC_ErrorMessage(e.message))}})),t.onDisconnect.addListener((e=>{this.eventEmitter.emit("disconnect",this)}))}onMessage(e){this.eventEmitter.on("message",e)}onDisconnect(e){this.eventEmitter.on("disconnect",e)}removeMessageListener(e){this.eventEmitter.removeListener("message",e)}removeDisconnectListener(e){this.eventEmitter.removeListener("disconnect",e)}postMessage(e){this.rawPort.postMessage(e)}}t.ExternalConnectionPort=i,t.defaultExternalConnectionPortFactory=function(e,t,a){return new i(e,t,a)},t.ExternalConnectionBroker=class{constructor(e,t){this.listenersForAPIs=new Map,this.nextPortId=0,chrome.runtime.onConnectExternal.addListener((a=>{const s=this.listenersForAPIs.get(a.name);if(!s)return a.postMessage(new r.AC_ErrorMessage(`No known API for ${a.name}`)),void a.disconnect();s(t(e,a,this.nextPortId++))}))}registerConnectionListener(e,t){if(this.listenersForAPIs.has(e))throw new Error("Listener already registered");this.listenersForAPIs.set(e,t)}}},725:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalConnectionMessageParser=t.AC_ErrorMessage=t.ExternalConnectionClientToApiMessage=t.ExternalConnectionApiToClientMessage=t.ExternalConnectionMessage=void 0;class a{constructor(e){this.type=e,this.id=a.nextId++}}t.ExternalConnectionMessage=a,a.nextId=0;class s extends a{}t.ExternalConnectionApiToClientMessage=s,t.ExternalConnectionClientToApiMessage=class extends a{get port(){return this._port}set port(e){this._port=e}},t.AC_ErrorMessage=class extends s{constructor(e){super("AC_Error"),this.message=e}},t.ExternalConnectionMessageParser=class{constructor(){this.parsers=new Map}registerMessageParser(e,t){this.parsers.set(e,t)}parse(e){const t=e.type;if("string"!=typeof t)throw new Error("Unreadable message type");const a=this.parsers.get(t);if(!a)throw new Error(`Unknown message type ${t}`);return a(e)}}},688:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTag=t.MatcherRegex=void 0;class a{constructor(e){this.regex=new RegExp(e)}isMatch(e){return this.regex.test(e)}}t.MatcherRegex=a;class s{constructor(e,t,a,s,r,i){this.matchers=e,this.negative_matchers=t,this.tag=a,this.search_limit_days=s,this.min_matchers_to_qualify=r,this.active=i}static createFromJson(e){return e.map((e=>new s(e.matchers.map((e=>new a(e))),e.negative_matchers.map((e=>new a(e))),e.tag,e.search_limit_days,e.min_matchers_to_qualify,e.active)))}}t.HistoryTag=s},103:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagAssignedEventSource=void 0;class a{constructor(e){this.backend=e,this.tagAssignedCallback=()=>{this.fireEvent()}}static eventNameForTag(e){return`history-tag-assigned-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:a.eventNameForTag(this.backend.tagName)})}async activate(e){this.backend.watchForTagAssignment(e)&&this.backend.on("tag-assigned-at-random-time",this.tagAssignedCallback)}async deactivate(e){this.backend.stopWatching(e),this.backend.removeListener("tag-assigned-at-random-time",this.tagAssignedCallback)}}t.HistoryTagAssignedEventSource=a},628:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagEventsBackend=void 0;const s=a(100);class r{}class i{constructor(e,t,a,r,i,n,o){this.tagName=e,this.storageKey=t,this.extensionLaunchType=a,this.extensionLaunchTime=r,this.historyTagUpdater=i,this.historyTagStorage=n,this.state=o,this.eventEmitter=new s.EventEmitter,this.tagsChangedEventListener=()=>{this.reportTagAssigned()},this.watching=!1}static async make(e,t,a,s,n,o){const c=await new Promise((t=>chrome.storage.local.get(e,(a=>{var s;return t(null!==(s=a[e])&&void 0!==s?s:new r)}))));return c.tag_assigned_event_reported=!0===c.tag_assigned_event_reported,new i(s,e,a,t,n,o,c)}static getDefaultStorageKey(e){return`history_tag_assigned_event_source_${e}`}async wasRecentlyLaunchedWithTag(){const e=Date.now();return!("browser_launch"!==this.extensionLaunchType||e-this.extensionLaunchTime>i.LAUNCH_DELAY)&&(await this.historyTagUpdater.waitForPendingUpdate(),this.historyTagStorage.hasTag(this.tagName))}watchForTagAssignment(e){return!this.state.tag_assigned_event_reported&&(this.historyTagStorage.on("tags-changed",this.tagsChangedEventListener),this.watching=!0,!0)}stopWatching(e){this.watching&&(this.historyTagStorage.removeListener("tags-changed",this.tagsChangedEventListener),this.watching=!1)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async saveState(){chrome.storage.local.set({[this.storageKey]:this.state})}async setAlreadyReported(){this.state.tag_assigned_event_reported=!0,await this.saveState()}async reportTagAssigned(){!this.state.tag_assigned_event_reported&&this.historyTagStorage.hasTag(this.tagName)&&(await this.setAlreadyReported(),this.eventEmitter.emit("tag-assigned-at-random-time"))}}t.HistoryTagEventsBackend=i,i.LAUNCH_DELAY=2e4},553:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagStorage=void 0;const s=a(100),r=a(688);class i{constructor(e,t){this.tagState=e,this.variableStore=t,this.eventEmitter=new s.EventEmitter}hasTag(e){return!0===this.tagState.get(e)}static tagNameToStorageName(e){return`history_tag_${e}`}stateToStorage(){const e={history_tags:{}};return this.tagState.forEach(((t,a)=>e.history_tags[a]=t)),e}static async readHistoryTagsFromJson(e){const t=await fetch(chrome.runtime.getURL(e)),a=await t.json();return r.HistoryTag.createFromJson(a).filter((e=>e.active))}static registerVariables(e,t){t.forEach((t=>e.registerIntVariable(i.tagNameToStorageName(t.tag),0)))}static async load(e,t){const a=await new Promise((t=>chrome.storage.local.get(e,t))),s=new Map(Object.keys(a).map((e=>[e,!0===a[e]])));return new i(s,t)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async save(e){const t=Array.from(e.keys()).some((t=>this.tagState.get(t)!==e.get(t)))||Array.from(this.tagState.keys()).some((t=>this.tagState.get(t)!==e.get(t)));this.tagState=e;const a=this.stateToStorage();await new Promise((e=>chrome.storage.local.set(a,e)));for(const e of Array.from(this.tagState.entries()))await this.variableStore.setInt(i.tagNameToStorageName(e[0]),e[1]?1:0,"dont_flush");await this.variableStore.save(),t&&this.eventEmitter.emit("tags-changed")}}t.HistoryTagStorage=i},786:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagUpdater=void 0;class a{constructor(e,t,a){this.storage=e,this.tags=t,setInterval((()=>this.updateTags()),a)}init(e){e.on("start-providing-events",(()=>{this.updateTags()}))}async updateTags(){this.updatingAfterSpecChangePromise||(this.updatingAfterSpecChangePromise=(async()=>{await this.storage.save(await this.calculateTagsFromHistory())})(),await this.updatingAfterSpecChangePromise,this.updatingAfterSpecChangePromise=void 0)}async waitForPendingUpdate(){return this.updatingAfterSpecChangePromise?this.updatingAfterSpecChangePromise:Promise.resolve()}async searchHistory(e){return new Promise((t=>chrome.history.search({text:"",startTime:e,maxResults:1e5},t)))}anyResultMatches(e,t,a){return e.some((e=>!(!e.lastVisitTime||e.lastVisitTime<a)&&void 0!==t.find((t=>t.isMatch(e.url)))))}nResultsMatch(e,t,a,s){let r=Array.from(new Set(e.flat().map((e=>{if(e.lastVisitTime&&!(e.lastVisitTime<s))return void 0!==t.find((t=>t.isMatch(e.url)))?e.url:void 0})).filter((e=>e)).map((e=>e))));return t.filter((e=>r.some((t=>e.isMatch(t))))).length>=a}async calculateTagsFromHistory(){const e=Math.max(...this.tags.map((e=>e.search_limit_days))),t=await this.searchHistory(e);return new Map(await Promise.all(this.tags.map((async e=>{const s=Date.now()-e.search_limit_days*a.DAYS_TO_MS;return this.anyResultMatches(t,e.negative_matchers,s)?[e.tag,!1]:[e.tag,this.nResultsMatch(t,e.matchers,e.min_matchers_to_qualify,s)]}))))}}t.HistoryTagUpdater=a,a.DAYS_TO_MS=864e5},475:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InjectionBasedPageApiManager=t.InjectionBasedStartpageApi=t.InjectionBasedPageApi=t.StartpageContentScriptMessageRelay=void 0;const s=a(866),r=a(100),i=a(725),n=a(868),o=a(412);class c extends class{constructor(e){this.messageConverter=e,this.awaitingResponse=new Map}acceptContentScriptConnection(e){e.onMessage.addListener((t=>{this.onMessageFromContentScript(e,t)}))}async relayMessageFromApiClient(e,t){await this.postMessageToContentScript(this.messageConverter.convertCAToACS(e)),this.awaitingResponse.set(e.id,t)}handleEventMessage(e,t){return!1}onMessageFromContentScript(e,t){try{const a=this.messageConverter.covertRawCSAToCSA(t);if(this.handleEventMessage(e,a))return;const s=this.awaitingResponse.get(a.requestId);s&&(s.postMessage(this.messageConverter.convertCSAToAC(a)),this.awaitingResponse.delete(a.requestId))}catch(e){return}}}{constructor(e){super(e),this.contentScriptPortsForWindows=new Map,this.eventEmitter=new r.EventEmitter}hasContentScriptConnectionForWindow(e){return!!this.contentScriptPortsForWindows.get(e)}static defaultMessageConverter(){return{convertCAToACS:e=>{if("CA_CallStartpageFunction"===e.type){const t=e;switch(t.functionName){case"TestStartpageFunction":return n.CallTestStartpageFunctionMessage.fromParams(t.id,t.windowId,t.params);case"DisplayTargetedSDSection":return n.DisplayTargetedSDSectionFunctionMessage.fromParams(t.id,t.windowId,t.params);default:throw new Error(`Unrecognized function: ${t.functionName}`)}}throw new Error(`Message type ${e.type} does not map to a content script message`)},covertRawCSAToCSA:e=>{if("CSA_CallStartpageFunctionResponse"===e.type)return n.CSA_CallStartpageFunctionResponseMessage.fromRawMessage(e);if("CSA_StartpageAPIEvent"===e.type)return n.CSA_StartpageAPIEventMessage.fromRawMessage(e);throw new Error("Unknown message received")},convertCSAToAC:e=>{if("CSA_CallStartpageFunctionResponse"!==e.type)throw new Error(`Unsupported message type ${e.type}`);const t=e;return new o.AC_CallStartpageFunctionResponseMessage({result:t.result,data:t.data})}}}on(e,t){this.eventEmitter.on(e,t)}onStartpageEvent(e){this.eventEmitter.on("startpage-script-event",e)}acceptContentScriptConnection(e){const t=e.sender.tab.windowId;if(this.contentScriptPortsForWindows.has(t))return e.postMessage(new n.ACS_ErrorMessage("This window already has an active startpage content script connection")),void e.disconnect();this.contentScriptPortsForWindows.set(t,e),this.eventEmitter.emit("startpage-script-ready",t),e.onDisconnect.addListener((()=>{this.contentScriptPortsForWindows.delete(t)})),super.acceptContentScriptConnection(e)}async postMessageToContentScript(e){const t=e,a=this.contentScriptPortsForWindows.get(t.windowId);a?a.postMessage(t):await new Promise(((e,a)=>{chrome.windows.get(t.windowId,(e=>{e||a(new Error(`No window of id ${t.windowId}`)),a(new Error(`SD content script not ready in window id ${t.windowId}`))}))}))}handleEventMessage(e,t){if("CSA_StartpageAPIEvent"===t.type){const a=t;return this.eventEmitter.emit("startpage-script-event",e.sender.tab.windowId,a.name,a.data),!0}return!1}}t.StartpageContentScriptMessageRelay=c;class l{constructor(e,t,a){this.messageRelay=e,this.apiLevel=t,this.apiName=a,this.activeClients=[]}get apiLevelVariableName(){return`${this.apiName}_api_level`}registerVariables(e,t){e.registerIntVariable(this.apiLevelVariableName,this.apiLevel)}publishApiLevel(e){e.setInt(this.apiLevelVariableName,this.apiLevel)}onClientConnected(e){this.activeClients.push(e)}onClientDisconnected(e){this.activeClients.splice(this.activeClients.indexOf(e),1)}onMessageFromApiClient(e,t){"CA_GetApiLevel"!==t.type?this.messageRelay.relayMessageFromApiClient(t,e).then().catch((t=>{e.postMessage(new i.AC_ErrorMessage(t.message))})):e.postMessage(new o.AC_GetApiLevelResponseMessage(this.apiLevel))}acceptContentScriptConnection(e){this.messageRelay.acceptContentScriptConnection(e)}}t.InjectionBasedPageApi=l;class d extends l{constructor(e,t){super(t,d.API_LEVEL,d.API_PORT_NAME),this.externalConnectionMessageParser=e,this.startpageMessageRelay=t,this.externalConnectionMessageParser.registerMessageParser(o.CA_CallStartpageFunctionMessage.MESSAGE_TYPE,o.CA_CallStartpageFunctionMessage.fromRawMessage),this.externalConnectionMessageParser.registerMessageParser(o.CA_GetInjectedScriptStatusMessage.MESSAGE_TYPE,o.CA_GetInjectedScriptStatusMessage.fromRawMessage),(0,s.reloadStartpagesInAllWindowsWhenInBackground)((()=>{})),t.on("startpage-script-ready",(e=>this.onStartpageMessageSinkReady(e))),t.onStartpageEvent(((e,t,a)=>this.onStartpageEvent(e,t,a)))}onMessageFromApiClient(e,t){"CA_GetInjectedScriptStatus"!==t.type?super.onMessageFromApiClient(e,t):e.postMessage(new o.AC_GetInjectedScriptStatusResponseMessage(this.startpageMessageRelay.hasContentScriptConnectionForWindow(t.windowId)))}onStartpageMessageSinkReady(e){this.activeClients.forEach((t=>{t.postMessage(new o.AC_WindowScriptsReadyMessage(e))}))}onStartpageEvent(e,t,a){this.activeClients.forEach((s=>{s.postMessage(new o.AC_StartpageAPIEvent(e,t,a))}))}}t.InjectionBasedStartpageApi=d,d.API_PORT_NAME="sd_cs",d.API_LEVEL=3,t.InjectionBasedPageApiManager=class{constructor(e,t,a){this.pageApis=a,t.registerMessageParser(o.CA_GetApiLevelMessage.MESSAGE_TYPE,(()=>new o.CA_GetApiLevelMessage)),this.registerApisWithBroker(e),chrome.runtime.onConnect.addListener((e=>{const t=this.pageApis.get(e.name);if(!t)return e.postMessage(new n.ACS_ErrorMessage(`Content script claims to serve an API '${e.name}' that does not exist`)),void e.disconnect();t.acceptContentScriptConnection(e)}))}registerApisWithBroker(e){this.pageApis.forEach(((t,a)=>{e.registerConnectionListener(a,(e=>{t.onClientConnected(e),e.onMessage((a=>{t.onMessageFromApiClient(e,a)})),e.onDisconnect((()=>{t.onClientDisconnected(e)}))}))}))}static defaultServicedApiMap(e){const t=new Map;return t.set(d.API_PORT_NAME,new d(e,new c(c.defaultMessageConverter()))),t}static registerVariables(e,t){t.forEach(((t,a)=>{t.registerVariables(e,a)}))}}},412:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AC_GetInjectedScriptStatusResponseMessage=t.AC_GetApiLevelResponseMessage=t.AC_StartpageAPIEvent=t.AC_CallStartpageFunctionResponseMessage=t.AC_WindowScriptsReadyMessage=t.CA_CallStartpageFunctionMessage=t.UseInjectionBasedApiMessage=t.CA_GetInjectedScriptStatusMessage=t.CA_GetApiLevelMessage=t.ClientToApiInjectionBasedApiMessage=void 0;const s=a(87),r=a(725),i=a(725);class n extends r.ExternalConnectionClientToApiMessage{}t.ClientToApiInjectionBasedApiMessage=n;class o extends n{constructor(){super(o.MESSAGE_TYPE)}}t.CA_GetApiLevelMessage=o,o.MESSAGE_TYPE="CA_GetApiLevel";class c extends n{constructor(e){super(c.MESSAGE_TYPE),this.windowId=e}static fromRawMessage(e){const t=e.windowId;if("number"!=typeof t)throw new Error("windowId invalid");return new c(t)}}t.CA_GetInjectedScriptStatusMessage=c,c.MESSAGE_TYPE="CA_GetInjectedScriptStatus";class l extends n{constructor(e,t){super(e),this.functionName=t}}t.UseInjectionBasedApiMessage=l;class d extends l{constructor(e,t,a){super(d.MESSAGE_TYPE,e),this.windowId=t,this.params=a}static fromRawMessage(e){const t=e.functionName;if(t!==s.TEST_STARTPAGE_FUNCTION&&t!==s.DISPLAY_TARGETED_SD_SECTION_FUNCTION)throw new Error(`functionName invalid: ${t}`);const a=e.windowId;if("number"!=typeof a)throw new Error("windowId invalid");const r=e.params;if("object"!=typeof r)throw new Error("params should be an object");const i=new Map;for(const e in r)i.set(e,r[e]);return new d(t,a,i)}}t.CA_CallStartpageFunctionMessage=d,d.MESSAGE_TYPE="CA_CallStartpageFunction";class h extends i.ExternalConnectionApiToClientMessage{constructor(e){super(h.MESSAGE_TYPE),this.windowId=e}}t.AC_WindowScriptsReadyMessage=h,h.MESSAGE_TYPE="AC_WindowScriptsReady";class u extends i.ExternalConnectionApiToClientMessage{constructor(e){super(u.MESSAGE_TYPE),this.data=e}}t.AC_CallStartpageFunctionResponseMessage=u,u.MESSAGE_TYPE="AC_CallStartpageFunctionResponse";class p extends i.ExternalConnectionApiToClientMessage{constructor(e,t,a){super(p.MESSAGE_TYPE),this.windowId=e,this.name=t,this.data=a}}t.AC_StartpageAPIEvent=p,p.MESSAGE_TYPE="AC_StartpageAPIEvent";class g extends i.ExternalConnectionApiToClientMessage{constructor(e){super(g.MESSAGE_TYPE),this.apiLevel=e}}t.AC_GetApiLevelResponseMessage=g,g.MESSAGE_TYPE="AC_GetApiLevelResponse";class v extends i.ExternalConnectionApiToClientMessage{constructor(e){super(v.MESSAGE_TYPE),this.scriptsReady=e}}t.AC_GetInjectedScriptStatusResponseMessage=v,v.MESSAGE_TYPE="AC_GetInjectedScriptStatusResponse"},87:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DISPLAY_TARGETED_SD_SECTION_FUNCTION=t.TEST_STARTPAGE_FUNCTION=void 0,t.TEST_STARTPAGE_FUNCTION="TestStartpageFunction",t.DISPLAY_TARGETED_SD_SECTION_FUNCTION="DisplayTargetedSDSection"},853:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ManyTabsEventSource=void 0;class a{constructor(e,t=a.DEFAULT_MIN_NUMBER_OF_TABS,s=a.DEFAULT_EVENT_FIRE_DELAY){this.performanceVariableCollector=e,this.minNumberOfTabs=t,this.timeToFireEvent=s}areManyTabsOpen(){return this.performanceVariableCollector.totalTabNumber>=this.minNumberOfTabs}async fireEventCallback(){this.areManyTabsOpen()&&opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME}),delete this.timeoutId}async onTotalTabNumberChangedListener(){this.areManyTabsOpen()?void 0===this.timeoutId&&(this.timeoutId=setTimeout(this.fireEventCallback.bind(this),this.timeToFireEvent)):void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),delete this.timeoutId)}async activate(){this.listenerObject=()=>this.onTotalTabNumberChangedListener(),this.performanceVariableCollector.addTotalTabNumberChangedListener(this.listenerObject)}async deactivate(){this.performanceVariableCollector.removeTotalTabNumberChangedListener(this.listenerObject),delete this.listenerObject,clearTimeout(this.timeoutId),delete this.timeoutId}}t.ManyTabsEventSource=a,a.EVENT_SOURCE_NAME="many-tabs-grow-2382",a.DEFAULT_MIN_NUMBER_OF_TABS=25,a.DEFAULT_EVENT_FIRE_DELAY=6e5},756:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ManyTabsFlowEventSource=void 0;class a{constructor(e,t=a.DEFAULT_MIN_NUMBER_OF_TABS,s=a.DEFAULT_EVENT_FIRE_DELAY){this.performanceVariableCollector=e,this.minNumberOfTabs=t,this.timeToFireEvent=s,chrome.tabs.onActivated.addListener((()=>{void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>{this.fireEventCallback()}),this.timeToFireEvent))}))}areManyTabsOpen(){return this.performanceVariableCollector.currentWindowTabNumber>this.minNumberOfTabs}async fireEventCallback(){this.areManyTabsOpen()&&opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME}),delete this.timeoutId}async onCurrentWindowTabNumberChangedListener(){this.areManyTabsOpen()?void 0===this.timeoutId&&(this.timeoutId=setTimeout((()=>{this.fireEventCallback()}),this.timeToFireEvent)):void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),delete this.timeoutId)}async activate(){this.listenerObject=()=>this.onCurrentWindowTabNumberChangedListener(),this.performanceVariableCollector.addCurrentWindowTabNumberChangedListener(this.listenerObject)}async deactivate(){this.performanceVariableCollector.removeCurrentWindowTabNumberChangedListener(this.listenerObject),delete this.listenerObject,clearTimeout(this.timeoutId),delete this.timeoutId}}t.ManyTabsFlowEventSource=a,a.EVENT_SOURCE_NAME="many-tabs-flow-grow-2432",a.DEFAULT_MIN_NUMBER_OF_TABS=15,a.DEFAULT_EVENT_FIRE_DELAY=6e5},463:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceVariableCollector=void 0;const s=a(100);class r{constructor(e,t,a){this.constants=e,this.variableStore=t,this.clock=a,this.eventEmitter=new s.EventEmitter,this.totalActiveDaysNumber=0,this.allDayPassed=!0,this.incrementDate="1/1/1970"}static isBoosterApiAvailable(e){return"gx"===e.productType}static isLimitersApiAvailable(e){return"gx"===e.productType}static isPowerSaverApiAvailable(){return void 0!==opr.powerSavePrivate&&void 0!==opr.powerSavePrivate.onBatteryStatusChanged&&void 0!==opr.powerSavePrivate.onStatusChanged}static registerVariables(e,t){t.registerIntVariable("downloads_size",this.VARIABLES.downloads_size.default),t.registerIntVariable("total_tab_count",this.VARIABLES.total_tab_count.default),t.registerIntVariable("current_window_tab_count",this.VARIABLES.current_window_tab_count.default),r.isBoosterApiAvailable(e)&&t.registerIntVariable("browser_files_size",this.VARIABLES.browser_files_size.default),r.isLimitersApiAvailable(e)&&t.registerIntVariable("ram_usage",this.VARIABLES.ram_usage.default),r.isPowerSaverApiAvailable()&&(t.registerStringVariable("battery_status",this.VARIABLES.battery_status.default),t.registerIntVariable("battery_level_percent",this.VARIABLES.battery_level_percent.default),t.registerIntVariable("battery_saver_enabled",this.VARIABLES.battery_saver_enabled.default),t.registerIntVariable("battery_saver_is_saving_now",this.VARIABLES.battery_saver_is_saving_now.default),t.registerIntVariable("battery_saver_auto_on_enabled",this.VARIABLES.battery_saver_auto_on_enabled.default),t.registerIntVariable("active_days_count",this.VARIABLES.active_days_count.default))}async init(){chrome.tabs.onCreated.addListener((()=>{this.collectTabStats(),this.collectCurrentWindowTabStats(),this.collectActiveDaysStats()})),chrome.tabs.onRemoved.addListener((()=>{this.collectTabStats(),this.collectCurrentWindowTabStats(),this.collectActiveDaysStats()}));const e=()=>this.collectActiveDaysStats();this.allDayPassed||(chrome.tabs.onCreated.removeListener(e),chrome.tabs.onRemoved.removeListener(e)),chrome.windows.onFocusChanged.addListener((()=>this.collectCurrentWindowTabStats())),chrome.downloads.onChanged.addListener((()=>this.collectDownloadsStats())),chrome.downloads.onErased.addListener((()=>this.collectDownloadsStats())),chrome.downloads.onCreated.addListener((()=>this.collectDownloadsStats())),this.clock.setOnBeforeMinutePassedBarrier((()=>this.collectPerformanceStats())),chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.find((e=>"power_save_mode.feature_enabled"===e.key||"power_save_mode.automatic_enabled"===e.key))&&this.collectPrefs()})),r.isPowerSaverApiAvailable()&&(opr.powerSavePrivate.onStatusChanged.addListener((e=>this.setBatterySaverIsSavingVariable(e.isEnabled))),opr.powerSavePrivate.onBatteryStatusChanged.addListener((e=>this.setBatteryStatusVariables(e)))),await this.collectTabStats(),await this.collectCurrentWindowTabStats(),await this.collectDownloadsStats(),await this.collectPerformanceStats(),await this.collectBatteryStats(),await this.collectActiveDaysStats()}get totalTabNumber(){return this.totalTabNumber_}get currentWindowTabNumber(){return this.currentWindowTabNumber_}addTotalTabNumberChangedListener(e){this.eventEmitter.on("total-tab-number-changed",e)}removeTotalTabNumberChangedListener(e){this.eventEmitter.removeListener("total-tab-number-changed",e)}addCurrentWindowTabNumberChangedListener(e){this.eventEmitter.on("current-window-tab-number-changed",e)}removeCurrentWindowTabNumberChangedListener(e){this.eventEmitter.removeListener("current-window-tab-number-changed",e)}async collectTabStats(){const e=await new Promise((e=>chrome.windows.getAll({populate:!0},e)));this.totalTabNumber_=e.filter((e=>"normal"===e.type)).map((e=>e.tabs.length)).reduce(((e,t)=>t+e),0),this.variableStore.setInt("total_tab_count",this.totalTabNumber_),this.eventEmitter.emit("total-tab-number-changed",this.totalTabNumber_)}async collectCurrentWindowTabStats(){this.currentWindowTabNumber_=(await new Promise((e=>chrome.tabs.query({currentWindow:!0,pinned:!1},e)))).length,this.variableStore.setInt("current_window_tab_count",this.currentWindowTabNumber_),this.eventEmitter.emit("current-window-tab-number-changed",this.currentWindowTabNumber_)}async collectActiveDaysStats(){this.allDayPassed&&(this.totalActiveDaysNumber=Number(localStorage.getItem("currentActiveDaysNumber")),isNaN(this.totalActiveDaysNumber)&&(this.totalActiveDaysNumber=0),this.incrementDate=localStorage.getItem("incrementDate"),this.incrementDate!==(new Date).toLocaleDateString()&&(this.totalActiveDaysNumber=++this.totalActiveDaysNumber,this.incrementDate=(new Date).toLocaleDateString(),localStorage.setItem("incrementDate",this.incrementDate)),this.allDayPassed=!1,setTimeout((()=>{this.allDayPassed=!0}),function(){const e=new Date;return new Date(e).setHours(24,0,0,0)-e}()),this.variableStore.setInt("active_days_count",this.totalActiveDaysNumber),localStorage.setItem("currentActiveDaysNumber",String(this.totalActiveDaysNumber)))}async getDownloadsDiskSpace(){return new Promise((e=>{chrome.downloads.search({exists:!0},(t=>{e(t.reduce(((e,t)=>e+(t.exists?t.bytesReceived:0)),0))}))}))}async collectDownloadsStats(){var e;this.variableStore.setInt("downloads_size",(e=await this.getDownloadsDiskSpace(),Math.floor(e/1048576)))}async collectPerformanceStats(){if(r.isBoosterApiAvailable(this.constants)){const e=await new Promise((e=>chrome.boosterPrivate.getTotalUsedDiskSpace(e)));this.variableStore.setInt("browser_files_size",e)}if(r.isLimitersApiAvailable(this.constants)){const e=await new Promise((e=>opr.limitersPrivate.getCurrentMemoryUsage(e)));this.variableStore.setInt("ram_usage",e.memoryUsed)}}async collectPrefs(){const e=await new Promise((e=>chrome.settingsPrivate.getPref("power_save_mode.automatic_enabled",e)));this.variableStore.setInt("battery_saver_auto_on_enabled",e.value?1:0);const t=await new Promise((e=>chrome.settingsPrivate.getPref("power_save_mode.feature_enabled",e)));this.variableStore.setInt("battery_saver_enabled",t.value?1:0)}async setBatteryStatusVariables(e){this.variableStore.setString("battery_status",e.dischargingState),this.variableStore.setInt("battery_level_percent",Math.round(100*e.level))}async setBatterySaverIsSavingVariable(e){this.variableStore.setInt("battery_saver_is_saving_now",e?1:0)}async collectBatteryStats(){if(!r.isPowerSaverApiAvailable())return;const e=await new Promise((e=>opr.powerSavePrivate.getStatus(e)));await this.setBatterySaverIsSavingVariable(e.isEnabled);const t=await new Promise((e=>opr.powerSavePrivate.getBatteryStatus(e)));await this.setBatteryStatusVariables(t),await this.collectPrefs()}}t.PerformanceVariableCollector=r,r.VARIABLES={total_tab_count:{default:0,description:"Total tabs in all windows"},current_window_tab_count:{default:0,description:"Number of tabs in current window"},ram_usage:{default:0,description:"RAM usage (polled every minute)"},browser_files_size:{default:0,description:"Browser file size (polled every minute)"},downloads_size:{default:0,description:"Downloads size (polled every minute)"},battery_status:{default:"UNKNOWN",description:"Battery status: CHARGING, DISCHARGING, UNKNOWN"},battery_level_percent:{default:100,description:"Battery level 0-100"},battery_saver_enabled:{default:0,description:"Whether the battery saver feature is enabled"},battery_saver_is_saving_now:{default:0,description:"Whether the battery saver is saving power"},battery_saver_auto_on_enabled:{default:0,description:"Whether the battery saver turns on automatically"},active_days_count:{default:0,description:"Number of active user days"}}},744:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TabChangedEventSource=void 0;class a{constructor(e,t,a,s){this.fireEvent=e,this.onTabActivated=t,this.tabsGetFunction=a,this.variableStore=s}static registerVariables(e){e.registerStringVariable("last_navigation",this.VARIABLES.last_navigation.default)}async listener(e){const t=await new Promise((t=>this.tabsGetFunction(e.tabId,t)));await this.variableStore.setString("last_navigation",t.url),this.fireEvent({eventName:a.EVENT_SOURCE_NAME,windowId:e.windowId})}async activate(){this.listenerObject=this.listener.bind(this),this.onTabActivated.addListener(this.listenerObject)}async deactivate(){this.onTabActivated.removeListener(this.listenerObject),this.listenerObject=null}}t.TabChangedEventSource=a,a.VARIABLES={last_navigation:{default:"none",description:"Last navigated url"}},a.EVENT_SOURCE_NAME="tab-changed"},295:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryPatches=void 0;class a{constructor(){opr.browserSidebarPrivate&&opr.browserSidebarPrivate.onItemExpanded&&opr.browserSidebarPrivate.onItemExpanded.addListener(this.onItemExpanded)}onItemExpanded(e){e===a.LASTCARD_ID&&chrome.runtime.sendMessage(a.LASTCARD_ID,{type:"ToggleRedDot",data:!1})}}a.LASTCARD_ID="niedpkpgcoojodjamdaecieijchonfnm",t.TemporaryPatches=class{constructor(){this.lastpass=new a}}},922:(e,t)=>{function a(){return Math.floor((+new Date-+new Date("1601-01-01 00:00:00 UTC"))/36e5)}Object.defineProperty(t,"__esModule",{value:!0}),t.UiVariableCollector=void 0;class s{constructor(e){this.variableStore=e,this.windowObservers=new Map}static isAvailable(){return void 0!==opr.uiTrackerPrivate}static registerVariables(e){e.registerIntVariable("vpn_badge_interaction_timestamp",this.VARIABLES.vpn_badge_interaction_timestamp.default),e.registerIntVariable("vpn_enabled",this.VARIABLES.vpn_enabled.default),e.registerIntVariable("vpn_enabled_timestamp",this.VARIABLES.vpn_enabled_timestamp.default)}observeWindow(e){if(this.windowObservers.has(e.id))throw new Error("Window already observed");const t={vpnMouseObserver:(e,t)=>this.onVpnMouseAction(e,t),vpnStateObserver:(e,t)=>this.onVpnUiStateChanged(e,t)};this.windowObservers.set(e.id,t),opr.uiTrackerPrivate.onUiElementPropertyChanged.addListener(t.vpnStateObserver,e.id,"address_bar_vpn","UiState"),opr.uiTrackerPrivate.onUiElementAction.addListener(t.vpnMouseObserver,e.id,"address_bar_vpn","Mouse")}onWindowRemoved(e){this.windowObservers.delete(e)}onVpnMouseAction(e,t){t.error||"ET_MOUSE_RELEASED"===/[^\s]+/.exec(t.actionDetails)[0]&&this.variableStore.setInt("vpn_badge_interaction_timestamp",a())}onVpnUiStateChanged(e,t){if(t.error)return;const s=this.currentEnabledState;if(this.currentEnabledState="inactive"!==t.propertyValue&&"invisible"!==t.propertyValue,s!=this.currentEnabledState){const e=void 0===s,t=0===this.variableStore.getInt("vpn_enabled_timestamp");!this.currentEnabledState||e&&!t||this.variableStore.setInt("vpn_enabled_timestamp",a(),"dont_flush"),this.variableStore.setInt("vpn_enabled",this.currentEnabledState?1:0)}}async init(){const e=await new Promise((e=>chrome.windows.getAll({windowTypes:["normal"]},e)));chrome.windows.onCreated.addListener((e=>{"normal"===e.type&&this.observeWindow(e)})),chrome.windows.onRemoved.addListener((e=>this.onWindowRemoved(e))),e.forEach((e=>this.observeWindow(e)))}}t.UiVariableCollector=s,s.VARIABLES={vpn_badge_interaction_timestamp:{default:0,description:"Last interaction time with the VPN badge as a Webkit timestamp"},vpn_enabled:{default:0,description:"Current state of the VPN badge"},vpn_enabled_timestamp:{default:0,description:"Time when VPN was enabled as a Webkit timestamp"}}},955:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableRegistry=void 0,t.VariableRegistry=class{constructor(){this._variables=new Map}get variables(){return this._variables}registerIntVariable(e,t){this.variables.set(e,t)}registerStringVariable(e,t){this.variables.set(e,t)}}},3:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableStore=void 0;class a{constructor(e,t){this.storage=e,this.settings=t}static async saveInternal(e,t){await new Promise((a=>e.set(t,a)))}async setInt(e,t,a){if(!(e in this.settings.trigger_variables.int))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.int[e]=t,void 0!==a&&"flush"!==a||await this.save()}async setString(e,t,a){if(!(e in this.settings.trigger_variables.string))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.string[e]=t,void 0!==a&&"flush"!==a||await this.save()}getInt(e){const t=this.settings.trigger_variables.int[e];if(void 0===t)throw new Error("Variable not registered");return t}getString(e){const t=this.settings.trigger_variables.string[e];if(void 0===t)throw new Error("Variable not registered");return t}async save(){await a.saveInternal(this.storage,this.settings)}static async load(e,t){var s;const r={trigger_variables:null!==(s=(await new Promise((t=>e.get((e=>t(e)))))).trigger_variables)&&void 0!==s?s:{int:{},string:{}}};return["int","string"].forEach((e=>{const a=new Set;for(const s in r.trigger_variables[e])(()=>{const a=t.variables.get(s);return(void 0===a?"none":"string"==typeof a?"string":"int")!==e})()&&a.add(s);a.forEach((t=>{delete r.trigger_variables[e][t]}))})),t.variables.forEach(((e,t)=>{const a="string"==typeof e?"string":"int",s="string"==typeof e?"int":"string";t in r.trigger_variables[a]||(r.trigger_variables[a][t]=e),t in r.trigger_variables[s]&&delete r.trigger_variables[s][t]})),await a.saveInternal(e,r),new a(e,r)}}t.VariableStore=a},712:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VpnProEventSource=void 0;class a{constructor(e){this.variableStore=e}isSubscriptionValid(e){return Date.now()<new Date(e).getTime()}async onStateChange(e){if(e===opr.vpnProPrivate.State.SUBSCRIPTION_EXPIRED)return this.variableStore.setInt("vpnpro_subsc_expired",1),this.variableStore.setInt("vpnpro_subsc_active",0),void this.fireEvent();const t=await new Promise((e=>{opr.vpnProPrivate.getSubscriptionDetails((t=>{e(t.expiresAt)}))}));if(this.isSubscriptionValid(t)){const e=this.variableStore.getInt("vpnpro_subsc_active");this.variableStore.setInt("vpnpro_subsc_expired",0),this.variableStore.setInt("vpnpro_subsc_active",1),0===e&&this.fireEvent()}else this.variableStore.setInt("vpnpro_subsc_active",0)}async fireEvent(){await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME},e)))}static registerVariables(e){e.registerIntVariable("vpnpro_subsc_active",this.VARIABLES.vpnpro_subsc_active.default),e.registerIntVariable("vpnpro_subsc_expired",this.VARIABLES.vpnpro_subsc_expired.default)}static isAvailable(){return!!opr.vpnProPrivate}async activate(){this.listenerObject=e=>this.onStateChange(e),opr.vpnProPrivate.onStateChanged.addListener(this.listenerObject)}async deactivate(){opr.vpnProPrivate.onStateChanged.removeListener(this.listenerObject),delete this.listenerObject}}t.VpnProEventSource=a,a.EVENT_SOURCE_NAME="vpn-pro",a.VARIABLES={vpnpro_subsc_expired:{default:0,description:"Subscription expired: 0 - no/never activated, 1 - expired"},vpnpro_subsc_active:{default:0,description:"Subscription status: 0 - inactive/unknown, 1 - active"}}}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,a),i.exports}(()=>{const e=a(304),t=a(267),s=a(793),r=a(114),i=a(744),n=a(497),o=a(853),c=a(756),l=a(955),d=a(3),h=a(786),u=a(553),p=a(792),g=a(103),v=a(628),m=a(314),b=a(105),w=a(475),_=a(561),E=a(534),S=a(725),A=a(295),f=a(862),y=a(463),C=a(922),T=a(618),I=a(257),M=a(712),P=a(923),L=a(896);document.errorReporter=new r.ErrorReporter,document.addEventListener("DOMContentLoaded",(async()=>{const a=new I.Constants(await I.Constants.getProductType()),r=new S.ExternalConnectionMessageParser,N=w.InjectionBasedPageApiManager.defaultServicedApiMap(r),R=new l.VariableRegistry;i.TabChangedEventSource.registerVariables(R),n.CategoryEventSource.registerVariables(R),m.CashbackBadgeShownEventSource.registerVariables(R),M.VpnProEventSource.registerVariables(R),L.AriaEventSource.registerVariables(R),w.InjectionBasedPageApiManager.registerVariables(R,N),_.ExtensionPromotions.registerVariables(R),s.Adblock.registerVariables(R);const k=await u.HistoryTagStorage.readHistoryTagsFromJson("history-tags.json");u.HistoryTagStorage.registerVariables(R,k),f.AgentClock.registerVariables(R),y.PerformanceVariableCollector.registerVariables(a,R),C.UiVariableCollector.isAvailable()&&C.UiVariableCollector.registerVariables(R),T.CheckoutPageEventSource.isAvailable()&&T.CheckoutPageEventSource.registerVariables(R);const O=await d.VariableStore.load(chrome.storage.local,R);N.forEach((e=>e.publishApiLevel(O)));const V=new E.ExternalConnectionBroker(r,E.defaultExternalConnectionPortFactory);document.injectionBasedPageApiManager=new w.InjectionBasedPageApiManager(V,r,N),document.extensionPromotions=new _.ExtensionPromotions(O),document.adblock=new s.Adblock(O);const D=await(0,b.checkExtensionLaunchType)(),F=new f.AgentClock(O);await F.init(D),document.performanceVariableCollector=new y.PerformanceVariableCollector(a,O,F),document.performanceVariableCollector.init(),C.UiVariableCollector.isAvailable()&&(document.uiVariableCollector=new C.UiVariableCollector(O),document.uiVariableCollector.init());const B=new Map;B.set(i.TabChangedEventSource.EVENT_SOURCE_NAME,(()=>new i.TabChangedEventSource(opr.richHintsAgentPrivate.fireEvent,chrome.tabs.onActivated,chrome.tabs.get,O))),B.set(n.CategoryEventSource.EVENT_SOURCE_NAME,(()=>new n.CategoryEventSource(opr.richHintsAgentPrivate.fireEvent,chrome.tabs.onUpdated,chrome.tabs.onRemoved,O))),B.set(o.ManyTabsEventSource.EVENT_SOURCE_NAME,(()=>new o.ManyTabsEventSource(document.performanceVariableCollector))),B.set(c.ManyTabsFlowEventSource.EVENT_SOURCE_NAME,(()=>new c.ManyTabsFlowEventSource(document.performanceVariableCollector))),M.VpnProEventSource.isAvailable()&&B.set(M.VpnProEventSource.EVENT_SOURCE_NAME,(()=>new M.VpnProEventSource(O))),B.set(L.AriaEventSource.EVENT_SOURCE_NAME,(()=>new L.AriaEventSource(O))),m.CashbackBadgeShownEventSource.isAvailable()&&B.set(m.CashbackBadgeShownEventSource.EVENT_SOURCE_NAME,(()=>new m.CashbackBadgeShownEventSource(O))),T.CheckoutPageEventSource.isAvailable()&&B.set(T.CheckoutPageEventSource.EVENT_SOURCE_NAME,(()=>new T.CheckoutPageEventSource(O))),B.set(f.ClockEventSource.EVENT_SOURCE_NAME,(()=>new f.ClockEventSource(F))),B.set(P.AIToolsEventSource.EVENT_SOURCE_NAME,(()=>new P.AIToolsEventSource(opr.richHintsAgentPrivate.fireEvent)));const W=await u.HistoryTagStorage.load("history_tags",O),x=new h.HistoryTagUpdater(W,k,18e5),U=Date.now();for(const e of k){const t=await v.HistoryTagEventsBackend.make(v.HistoryTagEventsBackend.getDefaultStorageKey(e.tag),U,D,e.tag,x,W);B.set(p.BrowserLaunchedWithTagAssigned.eventNameForTag(e.tag),(()=>new p.BrowserLaunchedWithTagAssigned(t))),B.set(g.HistoryTagAssignedEventSource.eventNameForTag(e.tag),(()=>new g.HistoryTagAssignedEventSource(t)))}const j=new t.EventSourceFactoryImpl(B);document.eventRegistry=new e.EventRegistry(opr.richHintsAgentPrivate.onSpecificationUpdated,opr.richHintsAgentPrivate.provideEvents,j),document.patches=new A.TemporaryPatches,x.init(document.eventRegistry),document.eventRegistry.registerEvents()}),!1)})()})();