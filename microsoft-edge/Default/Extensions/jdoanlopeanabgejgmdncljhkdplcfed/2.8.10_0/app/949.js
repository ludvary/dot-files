"use strict";(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[949],{90949:(t,e,a)=>{a.r(e),a.d(e,{makeNotesStore:()=>c,useNotesStore:()=>l});var s=a(28692);class d{constructor(t){this.id=t.id,this.body=t.body,this.updatedDate=t.updatedDate,this.deleted=t.deleted,t.draft&&(this.draft=t.draft)}}class r{constructor(t){this.dataService=t}get(t){this.dataService.get(t)}create(t){return this.dataService.create(t.id,t)}update(t,e){return this.dataService.update(t,e)}}var i=a(34145),n=a(20144),o=a(84315),h=function(t,e,a,s){return new(a||(a=Promise))((function(d,r){function i(t){try{o(s.next(t))}catch(t){r(t)}}function n(t){try{o(s.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?d(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(i,n)}o((s=s.apply(t,e||[])).next())}))};function u(t,e){const a={};return Object.values(t).filter((t=>t.deleted===e)).sort(((t,e)=>e.updatedDate-t.updatedDate)).forEach((t=>a[t.id]=new d(t))),a}const c=(t=(()=>({noteService:new r(new i.U("notes"))}))().noteService)=>(0,s.Q_)("notes",{state:()=>({data:{},loading:!1,loaded:!1,activeItemId:""}),getters:{getItems:t=>u(t.data,!1),getDeletedItems:t=>u(t.data,!0),getItemById:t=>e=>{const a=t.data[e];return a?new d(a):null}},actions:{clearActiveItem(){this.activeItemId=""},refresh(e=!1){this.loading=!0,t.get({success:t=>{t.forEach((t=>n.ZP.set(this.data,t.id,t))),this.loaded=!0,this.loading=!1},queryParams:{loadDeleted:e}})},create(){var t;const e=null===(t=Object.values(this.data).find((t=>t.draft&&!t.body.length)))||void 0===t?void 0:t.id,a={id:e||(0,o.uuidv4)(),body:"",draft:!0,updatedDate:Date.now(),deleted:!1};return n.ZP.set(this.data,a.id,a),a},update(e,a){return h(this,void 0,void 0,(function*(){const s={body:a,updatedDate:Date.now()},d=Object.assign(Object.assign({},this.data[e]),s),{draft:r}=d;return delete d.draft,n.ZP.set(this.data,e,d),r&&d.body?yield t.create(d):r||(yield t.update(e,s)),d}))},delete(e){const a={deleted:!0,updatedDate:Date.now()},s=Object.assign({},this.data[e],a);return s.draft?(n.ZP.delete(this.data,e),Promise.resolve()):(n.ZP.set(this.data,e,s),t.update(e,a))},restore(e){return h(this,void 0,void 0,(function*(){if(!this.data[e])throw new Error("No note found to restore with id: "+e);const a={deleted:!1,updatedDate:Date.now()},s=Object.assign(Object.assign({},this.data[e]),a);return n.ZP.set(this.data,e,s),yield t.update(e,a),s}))}}}),l=c()},34145:(t,e,a)=>{a.d(e,{U:()=>r});var s=a(42935);const d=a(24960).Z;class r{constructor(t,{queryParams:e={},path:a="",mode:s="sync"}={}){this.type=t,this.queryParams=e,this.path=a,this.mode=s}get({path:t=this.path||this.type,mode:e=this.mode,success:a,failure:s,queryParams:r={}}){var i;t+=this.buildQueryString((null===(i=this.queryParams)||void 0===i?void 0:i.get)||{},r);const n=[this.type,{path:t,env:this.getEnv(),mode:e}];"server"===e?d.sendMessage({handler:"get",args:n}).then(a).catch(s):d.sendRecurringCrossTabMessage({msgId:this.type+":refreshed",handler:"get",args:n,success:a,failure:s})}create(t,e,{path:a=this.path||this.type,mode:s=this.mode}={}){const r=[this.type,t,e];return r.push({path:a,mode:s,env:this.getEnv()}),d.sendMessage({handler:"create",args:r})}update(t,e,{path:a=this.path||this.type,mode:s=this.mode,queryParams:r={}}={}){var i;const n=this.buildQueryString((null===(i=this.queryParams)||void 0===i?void 0:i.update)||{},r),o=[this.type,t,e];return o.push({path:a,mode:s,env:this.getEnv(),queryString:n}),d.sendMessage({handler:"update",args:o})}delete(t,{path:e=this.path||this.type,mode:a=this.mode}={}){const s=[this.type,t];return s.push({path:e,mode:a,env:this.getEnv()}),d.sendMessage({handler:"delete",args:s})}getEnv(){return{token:localStorage.getItem("token"),clientUuid:localStorage.getItem("client_uuid"),apiUrl:m.globals.urlRootApi,version:m.globals.version,tabId:s.Z}}buildQueryString(...t){const e=new URLSearchParams(Object.assign({},...t)).toString();return e?"?"+e:""}}}}]);