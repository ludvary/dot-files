"use strict";(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[3943],{35757:(e,t,i)=>{var s;i.d(t,{DY:()=>r,OL:()=>n,S9:()=>s,iW:()=>d,sY:()=>o}),function(e){e.List="list",e.Detail="detail"}(s||(s={}));const n=["tabs","sessions"],o={ERROR_STASH:"Oops, we couldn't save that session at this time.",ERROR_RESTORE:"Oops, we couldn't restore that session at this time.",ERROR_NO_OTHER_TABS:"No tabs to stash.",ERROR_DELETE:"Oops, there was a problem deleting that session.",ERROR_ALL_DELETE:"Oops, there was a problem deleting all sessions.",SUCCESSFUL_STASH_PARTIAL:" saved to a new session.",SUCCESSFUL_RESTORE_PARTIAL:" session restored.",SUCCESSFUL_ALL_DELETE:"All session deleted.",DELETE_PARTIAL:" session deleted."},r="chrome://newtab/",d="https://get.momentumdash.help/hc/en-us/articles/14474141114391"},25113:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(28149),n=i(1724);class o{constructor({key:e,tabs:t,index:i,color:o="grey",title:r="",collapsed:d=!1}){this.type=n.LL.Group,this.key=e,this.index=i,this.tabs=t.map((e=>new s.O(e))).sort(((e,t)=>e.index-t.index)),this.color=o,this.title=r,this.collapsed=d}}},9128:(e,t,i)=>{i.d(t,{z:()=>o});var s=i(74957),n=i(1724);class o{constructor({id:e,name:t,windows:i,activeWindowKey:s,browser:o,dateCreated:r}){this.windows=[],this.id=e,this.name=t,this.windows=i.map((e=>new n.Rz(e))),this.activeWindowKey=s,this.browser=o,this.dateCreated=r}get totalTabCount(){return this.windows.map((e=>e.tabCount)).reduce(((e,t)=>e+t))}get displayName(){return this.name||s.Z.getFriendlyDateTime(new Date(this.dateCreated))}get sessionDescriptionTabs(){const e=this.totalTabCount;return`${e} tab${e>1?"s":""}`}get sessionDescriptionWindows(){return`${this.windows.length} window${this.windows.length>1?"s":""}`}}},28149:(e,t,i)=>{i.d(t,{H:()=>o,O:()=>n});var s=i(1724);class n{constructor({key:e,title:t,url:i,pinned:n,index:o}){this.type=s.LL.Tab,this.key=e,this.title=t,this.url=i,this.pinned=n,this.index=o}}const o=e=>!("object"!=typeof e||!e)&&(Object.entries({key:"number",title:"string",url:"string",pinned:"boolean",index:"number"}).every((([t,i])=>t in e&&typeof e[t]===i))&&e.type===s.LL.Tab)},1724:(e,t,i)=>{i.d(t,{LL:()=>s,Rz:()=>r,ZQ:()=>d});var s,n=i(25113),o=i(28149);!function(e){e.Tab="Tab",e.Group="Group"}(s||(s={}));class r{constructor({key:e,activeTabKey:t,state:i,type:s,left:r,top:d,width:a,height:l,browserSessionKey:u,tabsAndGroups:c}){this.tabsAndGroups=[],this.key=e,this.activeTabKey=t,this.state=i,this.type=s,this.left=r,this.top=d,this.width=a,this.height=l,u&&(this.browserSessionKey=u),this.tabsAndGroups=c.map((e=>"tabs"in e?new n.Z(e):new o.O(e))).sort(((e,t)=>e.index-t.index))}get tabCount(){let e=0;return this.tabsAndGroups.forEach((t=>{e+=t instanceof o.O?1:t.tabs.length})),e}}const d=e=>!("object"!=typeof e||!e)&&Object.entries({key:"number",state:"string",type:"string",left:"number",top:"number",width:"number",height:"number"}).every((([t,i])=>t in e&&typeof e[t]===i))},94787:(e,t,i)=>{i.d(t,{A:()=>p});var s=i(9128),n=i(1724),o=i(74957),r=i(28149),d=i(25113),a=i(77140),l=i(35757),u=function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function d(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}a((s=s.apply(e,t||[])).next())}))},c=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};class h{constructor(e){this.dataService=e}get(e){this.dataService.get(e)}create(e){return this.dataService.create(e.id,e)}update(e,t,i={}){return this.dataService.update(e,t,i)}delete(e){return this.dataService.delete(e)}ensurePermissions(){return u(this,void 0,void 0,(function*(){return!!(yield a.H.permissions.contains(l.OL))||new Promise((e=>{m.cmd("modal.open","PERMISSION_REQUEST",{title:"Tab Stash requires additional permissions",description:"In order to save and restore your tabs, we require these additional permissions.",permissions:l.OL,resolve:e})}))}))}renameIdToKey(e){var{id:t}=e,i=c(e,["id"]);return Object.assign(Object.assign({},i),{key:t})}closeWindowsAndSetSessionIds(e){return u(this,void 0,void 0,(function*(){for(const t of e.windows){yield a.H.windows.remove(t.key);const e=yield a.H.sessions.getLastClosedSessionId().catch((e=>{console.error(e)}));e&&(t.browserSessionKey=e)}return e}))}restoreSession(e){return u(this,void 0,void 0,(function*(){const t=e.windows.filter((t=>t.key!==e.activeWindowKey)),i=e.windows.filter((t=>t.key===e.activeWindowKey)),s=yield a.H.tabs.query({currentWindow:!0}),n=s.find((e=>e.active));if(!n||!n.id)throw new Error("Could not find active tab id from current window");let o=n.windowId;for(const r of[...t,...i]){const t=yield this.restoreWindow(r,e.browser);r.key===e.activeWindowKey&&1===s.length&&t.id&&(n.pinned&&(yield a.H.tabs.update(n.id,{pinned:!1})),yield a.H.tabs.moveToWindow(n.id,t.id),o=t.id,n.pinned&&(yield a.H.tabs.update(n.id,{pinned:!0})))}yield this.focusTabAndWindow(n.id,o)}))}getSessionFromWindows(){return u(this,void 0,void 0,(function*(){const e=yield a.H.tabs.query({currentWindow:!0}),t=e.find((e=>e.active));let i=-1;t&&1!==e.length&&t.id&&(yield this.pullTabInNewWindow(t),i=t.windowId);const r={id:o.Z.uuidv4(),name:"",windows:[],activeWindowKey:i,browser:this.getCurrentBrowserOrigin(),dateCreated:(new Date).toISOString()},d=yield a.H.windows.getAll();for(let e of d)if(!e.focused){if(e=this.renameIdToKey(e),!(0,n.ZQ)(e))throw new Error(`window returned by browser (${r.browser}) does not satisfy IWindow type`);yield this.setTabsDataForWindow(e,r.browser),r.windows.push(e)}return new s.z(r)}))}openPartialSession(e){return u(this,void 0,void 0,(function*(){e instanceof n.Rz?yield this.fallbackRestoreWindow(e,this.getCurrentBrowserOrigin()):e instanceof d.Z?yield this.createGroup(e):e instanceof r.O&&(yield a.H.tabs.create({url:e.url,pinned:e.pinned}))}))}createGroup(e){return u(this,void 0,void 0,(function*(){const t=[];for(const i of e.tabs){const e=yield a.H.tabs.create({url:i.url,pinned:i.pinned});e.id&&t.push(e.id)}void 0!==chrome.tabs.group&&(yield a.H.tabs.group({tabIds:t}))}))}pullTabInNewWindow(e){return u(this,void 0,void 0,(function*(){const t=e.id;if(!t)throw new Error("Could not read tab id when pulling out tab from window");const i=yield a.H.windows.get(e.windowId),s={left:i.left,top:i.top,width:i.width,height:i.height};let n;if("normal"===i.state&&(n=yield a.H.windows.create(Object.assign({tabId:t},s))),n||(n=yield a.H.windows.create({tabId:t})),!n)throw new Error("Could not create window when pulling out tab from window");e.pinned&&(yield a.H.tabs.update(t,{pinned:!0}))}))}setTabsDataForWindow(e,t){var i,s;return u(this,void 0,void 0,(function*(){const o=(yield a.H.tabs.query({windowId:e.key})).map((e=>{if(Object.assign(e,{type:n.LL.Tab}),e=this.renameIdToKey(e),!(0,r.H)(e))throw new Error(`tab returned by browser (${t}) does not satisfy ITab type`);return[e.url,t+"://newtab/"].includes(window.location.href)&&(e.url=l.DY),e})),d=[];e.activeTabKey=(null===(i=o.find((e=>e.active)))||void 0===i?void 0:i.id)||-1;for(let e=0;e<o.length;e++){const t=o[e];if(t)if(~t.groupId&&void 0!==t.groupId){const i={key:t.groupId,index:0,type:n.LL.Group,tabs:o.filter((e=>e.groupId===t.groupId))};i.index=Number(null===(s=i.tabs[0])||void 0===s?void 0:s.index),e+=i.tabs.length-1,d.push(i)}else d.push(t)}e.tabsAndGroups=d}))}restoreWindow(e,t){return u(this,void 0,void 0,(function*(){const i=e.browserSessionKey;let s;return i&&(s=yield a.H.sessions.restoreWindow(i)),s||(s=yield this.fallbackRestoreWindow(e,t)),s}))}fallbackRestoreWindow(e,t){var i,s,n,o,l;return u(this,void 0,void 0,(function*(){let u;const h={},{tabsAndGroups:w,activeTabKey:p,key:m,browserSessionKey:y}=e,b=c(e,["tabsAndGroups","activeTabKey","key","browserSessionKey"]),v=w.map((e=>e instanceof r.O?[e]:e.tabs)).flat();if(Object.assign(h,b),h.url=this.getUrlArrayForWindowCreateFromTabs(v,t),["maximized","minimized","fullscreen"].includes(e.state)&&["width","height","left","top"].forEach((e=>delete h[e])),u=yield a.H.windows.create(h),u||(["left","top"].forEach((e=>delete h[e])),u=yield a.H.windows.create(h)),u||(["width","height"].forEach((e=>delete h[e])),u=yield a.H.windows.create(h)),!u)throw new Error("Could not create window");if(void 0!==chrome.tabs.group)for(const e of w){if(!(e instanceof d.Z))continue;const t=e.index,s=t+e.tabs.length,n={tabIds:null===(i=u.tabs)||void 0===i?void 0:i.slice(t,s).map((e=>e.id)),createProperties:{windowId:u.id}};yield a.H.tabs.group(n)}for(let e=0;e<v.length;e++){const t=v[e];if(null==t?void 0:t.pinned){const t=null===(n=null===(s=u.tabs)||void 0===s?void 0:s[e])||void 0===n?void 0:n.id;if(!t)continue;yield a.H.tabs.update(t,{pinned:!0})}}const f=v.find((e=>e.key===p));if(f){const e=v.indexOf(f),t=null===(l=null===(o=u.tabs)||void 0===o?void 0:o[e])||void 0===l?void 0:l.id;t&&(yield a.H.tabs.update(t,{active:!0}))}return u}))}getUrlArrayForWindowCreateFromTabs(e,t){const i=e=>e.startsWith(t+"-extension://")||e.startsWith(t+"://"),s=e.map((e=>e.url===l.DY&&o.Z.isFirefox()?"/dashboard.html":i(e.url)?e.url.replace(t,this.getCurrentBrowserOrigin()):e.url)).filter((e=>!(i(e)&&o.Z.isFirefox()||e.startsWith("about:"))));return 0===s.length&&s.push("/dashboard.html"),s}getCurrentBrowserOrigin(){return window.location.href.split("-")[0]||"chrome"}focusTabAndWindow(e,t){return u(this,void 0,void 0,(function*(){e&&(yield a.H.tabs.update(e,{active:!0})),t&&(yield a.H.windows.update(t,{focused:!0}))}))}}var w=i(34145);const p=()=>({tabStashService:new h(new w.U("tabs"))})},63943:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u,makeTabsStore:()=>a,useTabsStore:()=>l});var s=i(28692),n=i(94787),o=i(9128),r=i(20144),d=function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function d(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}a((s=s.apply(e,t||[])).next())}))};const a=(e=(0,n.A)().tabStashService)=>(0,s.Q_)("tabs",{state:()=>({data:{},loading:!1,loaded:!1,activeItemId:""}),getters:{getItems:e=>Object.values(e.data).map((e=>new o.z(e))).sort(((e,t)=>Date.parse(t.dateCreated)-Date.parse(e.dateCreated))),getItemById:e=>t=>{const i=e.data[t];return i?new o.z(i):null}},actions:{refresh(){this.loading=!0,e.get({success:e=>{e.forEach((e=>r.ZP.set(this.data,e.id,e))),this.loaded=!0,this.loading=!1}})},stashSession(){return d(this,void 0,void 0,(function*(){if(!(yield e.ensurePermissions()))return;const t=yield e.getSessionFromWindows();return 0===t.windows.length||(yield this.create(t),yield e.closeWindowsAndSetSessionIds(t),yield this.update(t.id,{windows:t.windows})),t}))},restoreSession(t){return d(this,void 0,void 0,(function*(){if(yield e.ensurePermissions())return yield e.restoreSession(t),yield this.delete(t.id),!0}))},create(t){return d(this,void 0,void 0,(function*(){r.ZP.set(this.data,t.id,t),yield e.create(t)}))},delete(t){return d(this,void 0,void 0,(function*(){r.ZP.delete(this.data,t),yield e.delete(t)}))},update(t,i){return d(this,void 0,void 0,(function*(){const s=this.data[t];if(!s)throw new Error(`No data found for ${t}`);const n=Object.assign(Object.assign({},s),i);r.ZP.set(this.data,t,n);const o=Object.keys(i).join(",");return yield e.update(t,n,{queryParams:{update_mask:o}}),n}))}}}),l=a(),u=l},77140:(e,t,i)=>{i.d(t,{H:()=>n});var s=i(74957);const n={tabs:{query:e=>new Promise((t=>chrome.tabs.query(e,t))),create:e=>new Promise((t=>chrome.tabs.create(e,t))),update:(e,t)=>new Promise((i=>chrome.tabs.update(e,t,i))),group:e=>new Promise((t=>chrome.tabs.group(e,t))),move:(e,t)=>new Promise((i=>chrome.tabs.move(e,t,i))),moveToWindow:(e,t)=>{return i=void 0,s=void 0,r=function*(){e&&t&&(yield n.tabs.move(e,{windowId:t,index:-1}))},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{a(r.next(e))}catch(e){t(e)}}function d(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(e){e(i)}))).then(n,d)}a((r=r.apply(i,s||[])).next())}));var i,s,o,r}},windows:{create:e=>new Promise((t=>chrome.windows.create(e,t))),remove:e=>new Promise((t=>{const i=()=>{chrome.sessions.onChanged.removeListener(i),t()};chrome.sessions.onChanged.addListener(i),chrome.windows.remove(e,(()=>{}))})),update:(e,t)=>new Promise((i=>chrome.windows.update(e,t,i))),get:e=>new Promise((t=>chrome.windows.get(e,{},t))),getAll:()=>new Promise((e=>chrome.windows.getAll(e)))},sessions:{restoreWindow:e=>new Promise((t=>chrome.sessions.restore(e,(e=>{(null==e?void 0:e.window)?t(null==e?void 0:e.window):(null==e?void 0:e.tab)?chrome.windows.get(e.tab.windowId||0,{},t):t(void 0)})))),getRecentlyClosedWindowSessionIds:()=>new Promise((e=>chrome.sessions.getRecentlyClosed({},(t=>{const i=[];t.forEach((e=>{var t;"window"in e&&(null===(t=e.window)||void 0===t?void 0:t.sessionId)&&i.push(e.window.sessionId)})),e(i)})))),getLastClosedSessionId:()=>new Promise((e=>chrome.sessions.getRecentlyClosed({maxResults:1},(t=>{var i,s,n,o;const r=(null===(s=null===(i=t[0])||void 0===i?void 0:i.window)||void 0===s?void 0:s.sessionId)||(null===(o=null===(n=t[0])||void 0===n?void 0:n.tab)||void 0===o?void 0:o.sessionId);if(!r)throw new Error("Could not get session ID from closed window");e(r)}))))},permissions:{request:e=>new Promise((t=>{s.Z.isFirefox()?s.Z.getBrowser().permissions.request({permissions:e}).then(t):chrome.permissions.request({permissions:e},t)})),contains:e=>new Promise((t=>{s.Z.isFirefox()?s.Z.getBrowser().permissions.contains({permissions:e}).then(t):chrome.permissions.contains({permissions:e},t)}))}}},34145:(e,t,i)=>{i.d(t,{U:()=>o});var s=i(42935);const n=i(24960).Z;class o{constructor(e,{queryParams:t={},path:i="",mode:s="sync"}={}){this.type=e,this.queryParams=t,this.path=i,this.mode=s}get({path:e=this.path||this.type,mode:t=this.mode,success:i,failure:s,queryParams:o={}}){var r;e+=this.buildQueryString((null===(r=this.queryParams)||void 0===r?void 0:r.get)||{},o);const d=[this.type,{path:e,env:this.getEnv(),mode:t}];"server"===t?n.sendMessage({handler:"get",args:d}).then(i).catch(s):n.sendRecurringCrossTabMessage({msgId:this.type+":refreshed",handler:"get",args:d,success:i,failure:s})}create(e,t,{path:i=this.path||this.type,mode:s=this.mode}={}){const o=[this.type,e,t];return o.push({path:i,mode:s,env:this.getEnv()}),n.sendMessage({handler:"create",args:o})}update(e,t,{path:i=this.path||this.type,mode:s=this.mode,queryParams:o={}}={}){var r;const d=this.buildQueryString((null===(r=this.queryParams)||void 0===r?void 0:r.update)||{},o),a=[this.type,e,t];return a.push({path:i,mode:s,env:this.getEnv(),queryString:d}),n.sendMessage({handler:"update",args:a})}delete(e,{path:t=this.path||this.type,mode:i=this.mode}={}){const s=[this.type,e];return s.push({path:t,mode:i,env:this.getEnv()}),n.sendMessage({handler:"delete",args:s})}getEnv(){return{token:localStorage.getItem("token"),clientUuid:localStorage.getItem("client_uuid"),apiUrl:m.globals.urlRootApi,version:m.globals.version,tabId:s.Z}}buildQueryString(...e){const t=new URLSearchParams(Object.assign({},...e)).toString();return t?"?"+t:""}}}}]);