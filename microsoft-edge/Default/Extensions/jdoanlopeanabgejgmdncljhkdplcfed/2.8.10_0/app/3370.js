"use strict";(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[3370],{91488:(t,e,i)=>{i.d(e,{R:()=>s});var n=i(25038);class s{constructor({id:t,url:e,title:i,pinned:s=!1,readOnly:r=!1}={}){if(!t||void 0===i||!e)throw new Error("Legacy link created with incomplete data");this.id=t,this.links=[new n.r({url:e})],this.title=i,this.pinned=!!s,this.readOnly=r}get hasManyLinks(){return this.links.length>1}}},25038:(t,e,i)=>{i.d(e,{G:()=>d,r:()=>a});var n=i(89608),s=i(84315),r=i(24749);class a{constructor({id:t=(0,s.uuidv4)(),url:e=""}={}){this.id=t,this.url=e}}function d({url:t},e){const i="links"+(void 0===e?"":`.${e}`);if(!t)throw new n.B({message:r.XO.URL_EMPTY,input:i});if(!m.utils.isValidUrl(t))throw new n.B({message:r.XO.URL_INVALID,input:i})}},72502:(t,e,i)=>{i.d(e,{p:()=>d,G:()=>o});var n=i(89608),s=i(25038),r=i(24749);function a(){const t=[];for(let e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);const e=crypto.getRandomValues(new Uint8Array(16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,t[e[0]]+t[e[1]]+t[e[2]]+t[e[3]]+"-"+t[e[4]]+t[e[5]]+"-"+t[e[6]]+t[e[7]]+"-"+t[e[8]]+t[e[9]]+"-"+t[e[10]]+t[e[11]]+t[e[12]]+t[e[13]]+t[e[14]]+t[e[15]]}class d{constructor({id:t=a(),links:e=[],title:i="",pinned:n=!1,readOnly:r=!1}={}){this.id=t,this.links=e.map((t=>new s.r(t))),this.title=i,this.pinned=!!n,this.readOnly=r}get hasManyLinks(){return this.links.length>1}}function o({title:t,links:e}){if(0===t.length)throw new n.B({message:r.XO.TITLE_EMPTY,input:"title"});if(0===e.length)throw new n.B({message:r.XO.URL_EMPTY,input:"links.0"});e.forEach(((t,i)=>{(t.url||1===e.length)&&(0,s.G)(t,i)}))}},96380:(t,e,i)=>{i.d(e,{km:()=>d,m0:()=>a,wc:()=>o});var n=i(24749),s=i(72502),r=i(25038);class a{constructor(t){this.dataService=t}get(t){this.dataService.get(t)}create(t){return this.dataService.create(t.id,t)}update(t,e){return this.dataService.update(t,e)}delete(t){return this.dataService.delete(t)}}function d(t){return[{id:t.id,title:t.title,pinned:t.pinned,type:n.Un.LinkGroup,readOnly:!1,linksOrderIds:t.links.map((t=>t.id))},...t.links.map((e=>({id:e.id,type:n.Un.Link,url:e.url,parentLinkId:t.id})))]}function o(t){const e=Object.assign(new s.p,t);return e.links=e.links.filter((t=>t.url.length)).map((t=>Object.assign(new r.r,t,{url:t.url.includes("://")?t.url:"https://"+t.url}))),e}},23370:(t,e,i)=>{i.r(e),i.d(e,{default:()=>I,makeLinksStore:()=>k,useLinksStore:()=>f});var n=i(28692),s=i(20144),r=i(24749);function a(t){return t.type===r.Un.LinkGroup&&!t.isRoot}function d(t){return t.type===r.Un.Legacy}function o(t){return t.type===r.Un.Link}function h(t){return t.type===r.Un.LinkGroup&&"isRoot"in t&&t.isRoot&&!("isTeamRoot"in t&&t.isTeamRoot)}function u(t){return t.type===r.Un.LinkGroup&&"isTeamRoot"in t&&t.isTeamRoot}var l=i(96380),c=i(34145),p=i(72502),m=i(94119),g=i(91488),v=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{o(n.next(t))}catch(t){r(t)}}function d(t){try{o(n.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,d)}o((n=n.apply(t,e||[])).next())}))};const k=(t=(()=>({linksService:new l.m0(new c.U("links"))}))().linksService)=>(0,n.Q_)("links",{state:()=>({data:{},loading:!1,loaded:!1,activeItemId:"",activeItem:null,addMockPlugin:!0}),getters:{service:()=>t,getItems(){return({pinned:t=!1,team:e=!1}={})=>{var i;const n=e?this.getTeamRoot:this.getRoot;if(!n)return[];const s=[];return null===(i=n.linksOrderIds)||void 0===i||i.forEach((e=>{const i=this.getItemById(e);if(i&&(a(i)||d(i))&&(e=>"pinned"in e?e.pinned===t:!t)(i)){let t;a(i)?t=this.buildLinkGroup(i):d(i)&&(t=new g.R(i)),t&&t.links.length&&s.push(t)}})),s}},getUnPinnedItems(){return this.getItems()},getPinnedItems(){return this.getItems({pinned:!0})},getUnPinnedTeamItems(){return this.getItems({team:!0})},getPinnedTeamItems(){return this.getItems({pinned:!0,team:!0})},getRoot:t=>Object.values(t.data).find(h)||null,getTeamRoot:t=>Object.values(t.data).find(u)||null,getItemById:t=>e=>t.data[e]||null,buildLinkGroup(){return t=>{var e;const i=[];null===(e=t.linksOrderIds)||void 0===e||e.forEach((t=>{const e=this.getItemById(t);e&&o(e)&&i.push(e)}));const n=Object.assign(Object.assign({},t),{links:i});return new p.p(n)}},adding(){return!(!this.activeItem||this.activeItemId)}},actions:{addItem(){this.activeItem=new p.p},editItem(t){this.activeItemId=t;const e=this.getItemById(t);e&&a(e)&&(this.activeItem=this.buildLinkGroup(e))},clearActiveItem(){this.activeItem=null,this.activeItemId=""},refresh(){this.loading=!0,t.get({success:t=>{t.forEach((t=>s.ZP.set(this.data,t.id,t))),this.loaded=!0,this.loading=!1}})},updatePartialRootLinksOrderIds(t){return v(this,void 0,void 0,(function*(){const e=this.getRoot;e&&(yield this.update(e.id,{linksOrderIds:[...new Set([...t,...e.linksOrderIds])]}))}))},deleteLinkGroup(t){return v(this,void 0,void 0,(function*(){const e=this.getItemById(t);if(!e||!a(e)&&!d(e))throw new Error(`Can't find LinkGroup with id ${t}`);yield Promise.allSettled(Object.values(this.data).filter((i=>o(i)&&i.parentLinkId===t||i===e)).map((t=>this.delete(t.id))))}))},processMutations(t){return v(this,void 0,void 0,(function*(){t.filter((t=>t.method!==m.MutationMethod.Delete&&"linksOrderIds"in t.data)).forEach((e=>{if(e.method===m.MutationMethod.Create&&a(e.data)){const i=e.data.linksOrderIds;t.push({method:m.MutationMethod.Update,id:e.id,data:{linksOrderIds:i}}),Object.assign(e.data,{linksOrderIds:[]});const n=this.getRoot;if(!n)throw new Error("Can't fint RootLink");t.push({method:m.MutationMethod.Update,id:n.id,data:{linksOrderIds:[...n.linksOrderIds,e.id]}})}else e.method===m.MutationMethod.Update&&(t=t.filter((t=>t!==e))).push(e)}));for(const e of t)switch(e.method){case m.MutationMethod.Update:yield this.update(e.id,e.data);break;case m.MutationMethod.Create:if(h(e.data))throw new Error("Can't create root links");if(u(e.data))throw new Error("Can't create root links");if(d(e.data))throw new Error("Can't create legacy links");yield this.create(e.data);break;case m.MutationMethod.Delete:{const t=this.getItemById(e.id);if(!t)return;if(h(t))throw new Error("Can't delete root links");if(u(t))throw new Error("Can't delete team root links");yield this.delete(e.id);break}}}))},create(e){return v(this,void 0,void 0,(function*(){return s.ZP.set(this.data,e.id,e),yield t.create(e),e}))},update(e,i){return v(this,void 0,void 0,(function*(){const n=this.getItemById(e);if(!n)throw new Error(`No data found for ${e}`);const r=Object.assign(Object.assign({},n),i);return s.ZP.set(this.data,e,r),yield t.update(e,i),r}))},delete(e){return v(this,void 0,void 0,(function*(){return s.ZP.delete(this.data,e),t.delete(e)}))}}}),f=k(),I=f},89608:(t,e,i)=>{i.d(e,{B:()=>n});class n{constructor(t){this.message=t.message,this.contact=!!t.contact,t.input&&(this.input=t.input)}}},34145:(t,e,i)=>{i.d(e,{U:()=>r});var n=i(42935);const s=i(24960).Z;class r{constructor(t,{queryParams:e={},path:i="",mode:n="sync"}={}){this.type=t,this.queryParams=e,this.path=i,this.mode=n}get({path:t=this.path||this.type,mode:e=this.mode,success:i,failure:n,queryParams:r={}}){var a;t+=this.buildQueryString((null===(a=this.queryParams)||void 0===a?void 0:a.get)||{},r);const d=[this.type,{path:t,env:this.getEnv(),mode:e}];"server"===e?s.sendMessage({handler:"get",args:d}).then(i).catch(n):s.sendRecurringCrossTabMessage({msgId:this.type+":refreshed",handler:"get",args:d,success:i,failure:n})}create(t,e,{path:i=this.path||this.type,mode:n=this.mode}={}){const r=[this.type,t,e];return r.push({path:i,mode:n,env:this.getEnv()}),s.sendMessage({handler:"create",args:r})}update(t,e,{path:i=this.path||this.type,mode:n=this.mode,queryParams:r={}}={}){var a;const d=this.buildQueryString((null===(a=this.queryParams)||void 0===a?void 0:a.update)||{},r),o=[this.type,t,e];return o.push({path:i,mode:n,env:this.getEnv(),queryString:d}),s.sendMessage({handler:"update",args:o})}delete(t,{path:e=this.path||this.type,mode:i=this.mode}={}){const n=[this.type,t];return n.push({path:e,mode:i,env:this.getEnv()}),s.sendMessage({handler:"delete",args:n})}getEnv(){return{token:localStorage.getItem("token"),clientUuid:localStorage.getItem("client_uuid"),apiUrl:m.globals.urlRootApi,version:m.globals.version,tabId:n.Z}}buildQueryString(...t){const e=new URLSearchParams(Object.assign({},...t)).toString();return e?"?"+e:""}}}}]);